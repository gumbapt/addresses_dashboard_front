# API Endpoints Documentation

This document lists all API endpoints used in the application with their request/response formats.

## Authentication

### Login
```
POST /api/admin/login
Content-Type: application/json

Request:
{
  "email": "admin@example.com",
  "password": "password"
}

Response:
{
  "admin": {
    "id": 1,
    "name": "Admin Name",
    "email": "admin@example.com",
    "is_active": true,
    "is_super_admin": false,
    "last_login_at": "2025-10-05 21:59:57"
  },
  "token": "12|...",
  "roles": [
    {
      "id": 1,
      "name": "Administrator",
      "slug": "admin",
      "description": "System Administrator",
      "is_active": true,
      "permissions": [...]
    }
  ]
}
```

### Logout
```
POST /api/admin/logout
Authorization: Bearer {token}
```

### Get Current User
```
GET /api/admin/me
Authorization: Bearer {token}
```

## Users Management

### List Users
```
GET /api/admin/users?page=1&per_page=15
Authorization: Bearer {token}

Response:
{
  "users": [...],
  "pagination": {
    "current_page": 1,
    "per_page": 15,
    "total": 100,
    "last_page": 7,
    "from": 1,
    "to": 15
  }
}
```

## Administrators Management

### List Administrators
```
GET /api/admin/admins?page=1&per_page=15
Authorization: Bearer {token}

Response:
{
  "admins": [...],
  "pagination": {...}
}
```

## Roles Management

### List All Roles
```
GET /api/admin/roles
Authorization: Bearer {token}

Response:
[
  {
    "id": 1,
    "name": "Super Admin",
    "slug": "super-admin",
    "description": "System Super Administrator",
    "is_active": true,
    "permissions": [...],
    "created_at": "2025-10-05 13:40:02",
    "updated_at": "2025-10-05 13:40:02"
  }
]
```

### Create Role
```
POST /api/admin/role/create
Authorization: Bearer {token}
Content-Type: application/json

Request:
{
  "name": "Manager",
  "description": "Team Manager",
  "permissions": [1, 2, 3] // Optional: Permission IDs
}

Response:
{
  "success": true,
  "data": {
    "role": {
      "id": 4,
      "name": "Manager",
      "slug": "manager", // Auto-generated by backend
      "description": "Team Manager",
      "is_active": true,
      "permissions": [...],
      "created_at": "2025-10-09 10:00:00",
      "updated_at": "2025-10-09 10:00:00"
    }
  }
}
```

### Update Role
```
PUT /api/admin/role/update
Authorization: Bearer {token}
Content-Type: application/json

Request:
{
  "id": 4,
  "name": "Updated Manager",
  "description": "Updated Description"
}

Response:
{
  "success": true,
  "data": {
    "role": {...}
  }
}
```

### Delete Role
```
POST /api/admin/role/delete
Authorization: Bearer {token}
Content-Type: application/json

Request:
{
  "id": 4
}

Response:
{
  "success": true
}
```

### Update Role Permissions
```
POST /api/admin/role/update-permissions
Authorization: Bearer {token}
Content-Type: application/json

Request:
{
  "id": 4,
  "permissions": [1, 2, 3, 4, 5] // Array of permission IDs
}

Response:
{
  "success": true,
  "data": {
    "role": {
      "id": 4,
      "name": "Manager",
      "permissions": [...]
    }
  }
}

Note: Empty array [] removes all permissions
```

## Permissions Management

### List All Permissions
```
GET /api/admin/permissions
Authorization: Bearer {token}

Response:
{
  "success": true,
  "data": [
    {
      "id": 1,
      "name": "Create Administrator",
      "slug": "admin-create",
      "description": "Allows creating new administrators",
      "is_active": true,
      "resource": "admin",
      "action": "create",
      "route": null
    }
  ]
}
```

## Error Responses

### Authentication Error
```
{
  "error": "Invalid credentials"
}
Status: 401
```

### Permission Denied
```
{
  "error": "Admin {id} does not have permission to perform this action. Required permission: {permission-slug}"
}
Status: 403
```

### Validation Error
```
{
  "error": "Validation failed",
  "errors": {
    "name": ["The name field is required"],
    "email": ["The email must be a valid email address"]
  }
}
Status: 422
```

### Not Found
```
{
  "error": "Resource not found"
}
Status: 404
```

### Server Error
```
{
  "error": "Internal server error"
}
Status: 500
```

## Permission Required by Endpoint

| Endpoint | Permission Required |
|----------|-------------------|
| GET /users | `user-read` |
| GET /admins | `admin-read` |
| GET /roles | `role-read` |
| POST /role/create | `role-create` |
| PUT /role/update | `role-update` |
| POST /role/delete | `role-delete` |
| POST /role/update-permissions | `role-manage` |
| GET /permissions | `role-read` or `role-manage` |

## Notes

- All endpoints (except login) require `Authorization: Bearer {token}` header
- Super admins bypass all permission checks
- Tokens are returned on login and should be stored in localStorage
- Permissions are loaded from roles automatically on login
