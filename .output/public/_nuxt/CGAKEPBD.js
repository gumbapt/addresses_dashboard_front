import{e as S,s as $,x as ne,d as re,u as de,v as ie,f as ue,E as me,l as G,c as A,a as s,w as e,r as d,j as t,t as u,q as a,k as W,h as v,i as D,g as c,F as H,m as J,b as p}from"./AmEn0FOG.js";import{_ as L}from"./btuBwFtU.js";const ce=()=>{const R=S(!1),m=S(null),V=S({}),U=new ne,B=async(g,y,T)=>{R.value=!0,m.value=null,V.value={};try{const b={current_password:g,new_password:y,new_password_confirmation:T},r=await U.post("/change-password",b);return r.success||(m.value=r.message||"Error changing password"),r}catch(b){const r=b instanceof Error?b.message:"Error changing password. Please try again.";return r.includes("401")||r.toLowerCase().includes("incorrect")||r.toLowerCase().includes("unauthorized")?(m.value="Current password is incorrect",V.value.current_password=["Current password is incorrect"],{success:!1,message:"Current password is incorrect"}):r.includes("422")||r.toLowerCase().includes("validation")||r.toLowerCase().includes("invalid")?(m.value=r,{success:!1,message:r}):(m.value=r,{success:!1,message:r})}finally{R.value=!1}},_=()=>{m.value=null,V.value={}};return{loading:$(R),error:$(m),errors:$(V),changePassword:B,clearErrors:_}},pe={class:"pa-6"},_e={class:"d-flex gap-2"},fe={key:0,class:"text-center py-4"},we={class:"mt-1"},ve={class:"text-caption text-medium-emphasis"},ge={class:"d-flex gap-2"},ye={key:0,class:"text-center py-4"},be={class:"d-flex align-center"},xe={class:"text-capitalize"},ke={class:"d-flex flex-wrap gap-1 mt-1"},Pe={class:"text-caption text-medium-emphasis mt-1"},Ne=re({__name:"index",setup(R){const{user:m}=de(),{roles:V,permissions:U,isSuperAdmin:B}=ie(),{loading:_,error:g,errors:y,changePassword:T,clearErrors:b}=ce(),r=ue(),o=me({current_password:"",new_password:"",new_password_confirmation:""});S(!1);const x=S(!1),X=()=>{b();let f=!0;return o.current_password||(f=!1),o.new_password?o.new_password.length<8&&(f=!1):f=!1,o.new_password_confirmation?o.new_password!==o.new_password_confirmation&&(f=!1):f=!1,f},K=async()=>{if(x.value=!1,b(),!X()){r.warning("Please fill in all fields correctly");return}(await T(o.current_password,o.new_password,o.new_password_confirmation)).success?(x.value=!0,r.success("Password changed successfully!"),setTimeout(()=>{j(),x.value=!1},2e3)):g.value?r.error(g.value):r.error("Error changing password. Please check the fields and try again.")},j=()=>{o.current_password="",o.new_password="",o.new_password_confirmation="",b(),x.value=!1},Y=G(()=>m.value?.last_login_at?new Date(m.value.last_login_at).toLocaleString("pt-BR",{dateStyle:"medium",timeStyle:"short"}):"Never"),I=G(()=>{const f={};return U.value.forEach(l=>{const i=l.resource||"Other";f[i]||(f[i]=[]),f[i].push({...l})}),f}),Z=G(()=>Object.keys(I.value).sort());return(f,l)=>{const i=d("v-icon"),k=d("v-list-item-title"),P=d("v-list-item-subtitle"),C=d("v-list-item"),E=d("v-chip"),M=d("v-list"),w=d("v-col"),O=d("v-row"),z=d("v-text-field"),F=d("v-alert"),q=d("v-btn"),Q=d("v-form"),h=d("v-card-title"),ee=d("v-card-text"),se=d("v-card"),le=d("v-expansion-panel-title"),te=d("v-expansion-panel-text"),ae=d("v-expansion-panel"),oe=d("v-expansion-panels");return p(),A("div",pe,[s(O,null,{default:e(()=>[s(w,{cols:"12"},{default:e(()=>[s(L,{title:"My Profile"},{default:e(()=>[s(O,null,{default:e(()=>[s(w,{cols:"12",md:"6"},{default:e(()=>[s(M,{lines:"two",density:"compact"},{default:e(()=>[s(C,null,{prepend:e(()=>[s(i,{color:"primary",class:"mr-4"},{default:e(()=>l[6]||(l[6]=[t("mdi-account")])),_:1})]),default:e(()=>[s(k,null,{default:e(()=>l[7]||(l[7]=[t("Name")])),_:1}),s(P,null,{default:e(()=>[t(u(a(m)?.name||"N/A"),1)]),_:1})]),_:1}),s(C,null,{prepend:e(()=>[s(i,{color:"primary",class:"mr-4"},{default:e(()=>l[8]||(l[8]=[t("mdi-email")])),_:1})]),default:e(()=>[s(k,null,{default:e(()=>l[9]||(l[9]=[t("Email")])),_:1}),s(P,null,{default:e(()=>[t(u(a(m)?.email||"N/A"),1)]),_:1})]),_:1}),s(C,null,{prepend:e(()=>[s(i,{color:"primary",class:"mr-4"},{default:e(()=>l[10]||(l[10]=[t("mdi-account-check")])),_:1})]),default:e(()=>[s(k,null,{default:e(()=>l[11]||(l[11]=[t("Status")])),_:1}),s(P,null,{default:e(()=>[s(E,{color:a(m)?.is_active?"success":"error",size:"small"},{default:e(()=>[t(u(a(m)?.is_active?"Active":"Inactive"),1)]),_:1},8,["color"])]),_:1})]),_:1})]),_:1})]),_:1}),s(w,{cols:"12",md:"6"},{default:e(()=>[s(M,{lines:"two",density:"compact"},{default:e(()=>[s(C,null,{prepend:e(()=>[s(i,{color:"primary",class:"mr-4"},{default:e(()=>l[12]||(l[12]=[t("mdi-shield-crown")])),_:1})]),default:e(()=>[s(k,null,{default:e(()=>l[13]||(l[13]=[t("Admin Type")])),_:1}),s(P,null,{default:e(()=>[s(E,{color:a(B)?"warning":"info",size:"small"},{default:e(()=>[t(u(a(B)?"Super Admin":"Admin"),1)]),_:1},8,["color"])]),_:1})]),_:1}),s(C,null,{prepend:e(()=>[s(i,{color:"primary",class:"mr-4"},{default:e(()=>l[14]||(l[14]=[t("mdi-clock-outline")])),_:1})]),default:e(()=>[s(k,null,{default:e(()=>l[15]||(l[15]=[t("Last Login")])),_:1}),s(P,null,{default:e(()=>[t(u(Y.value),1)]),_:1})]),_:1}),s(C,null,{prepend:e(()=>[s(i,{color:"primary",class:"mr-4"},{default:e(()=>l[16]||(l[16]=[t("mdi-identifier")])),_:1})]),default:e(()=>[s(k,null,{default:e(()=>l[17]||(l[17]=[t("User ID")])),_:1}),s(P,null,{default:e(()=>[t(u(a(m)?.id||"N/A"),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),s(w,{cols:"12"},{default:e(()=>[s(L,{title:"Change Password",class:"border-primary"},{default:e(()=>[s(O,null,{default:e(()=>[s(w,{cols:"12",md:"8"},{default:e(()=>[s(Q,{onSubmit:W(K,["prevent"])},{default:e(()=>[s(z,{modelValue:o.current_password,"onUpdate:modelValue":l[0]||(l[0]=n=>o.current_password=n),label:"Current Password",type:"password",variant:"outlined",density:"compact","prepend-inner-icon":"mdi-lock","error-messages":a(y).current_password,disabled:a(_),class:"mb-3"},null,8,["modelValue","error-messages","disabled"]),s(z,{modelValue:o.new_password,"onUpdate:modelValue":l[1]||(l[1]=n=>o.new_password=n),label:"New Password",type:"password",variant:"outlined",density:"compact","prepend-inner-icon":"mdi-lock-plus","error-messages":a(y).new_password,disabled:a(_),hint:"Minimum 8 characters","persistent-hint":"",class:"mb-3"},null,8,["modelValue","error-messages","disabled"]),s(z,{modelValue:o.new_password_confirmation,"onUpdate:modelValue":l[2]||(l[2]=n=>o.new_password_confirmation=n),label:"Confirm New Password",type:"password",variant:"outlined",density:"compact","prepend-inner-icon":"mdi-lock-check","error-messages":a(y).new_password_confirmation,disabled:a(_),class:"mb-4"},null,8,["modelValue","error-messages","disabled"]),x.value?(p(),v(F,{key:0,type:"success",variant:"tonal",class:"mb-4"},{default:e(()=>l[18]||(l[18]=[t(" Password changed successfully! ")])),_:1})):D("",!0),a(g)&&!x.value?(p(),v(F,{key:1,type:"error",variant:"tonal",class:"mb-4"},{default:e(()=>[t(u(a(g)),1)]),_:1})):D("",!0),c("div",_e,[s(q,{type:"submit",color:"primary",loading:a(_),disabled:a(_)},{default:e(()=>[s(i,{start:""},{default:e(()=>l[19]||(l[19]=[t("mdi-key")])),_:1}),l[20]||(l[20]=t(" Change Password "))]),_:1},8,["loading","disabled"]),s(q,{variant:"outlined",onClick:j,disabled:a(_)},{default:e(()=>l[21]||(l[21]=[t(" Reset ")])),_:1},8,["disabled"])])]),_:1})]),_:1}),s(w,{cols:"12",md:"4"},{default:e(()=>[s(se,{variant:"tonal",color:"info",class:"pa-4"},{default:e(()=>[s(h,{class:"text-h6 mb-2"},{default:e(()=>[s(i,{class:"mr-2"},{default:e(()=>l[22]||(l[22]=[t("mdi-information")])),_:1}),l[23]||(l[23]=t(" Password Requirements "))]),_:1}),s(ee,null,{default:e(()=>l[24]||(l[24]=[c("ul",{class:"text-body-2"},[c("li",null,"Minimum 8 characters"),c("li",null,"Current password required"),c("li",null,"New password must be confirmed"),c("li",null,"Password change is immediate")],-1)])),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),s(w,{cols:"12",md:"6"},{default:e(()=>[s(L,{title:"Roles"},{default:e(()=>[a(V).length===0?(p(),A("div",fe,[s(i,{size:"48",color:"grey"},{default:e(()=>l[25]||(l[25]=[t("mdi-shield-off")])),_:1}),l[26]||(l[26]=c("p",{class:"text-body-1 text-medium-emphasis mt-2"},"No roles assigned",-1))])):(p(),v(M,{key:1,lines:"two",density:"compact"},{default:e(()=>[(p(!0),A(H,null,J(a(V),n=>(p(),v(C,{key:n.id},{prepend:e(()=>[s(i,{color:"primary",class:"mr-4"},{default:e(()=>l[27]||(l[27]=[t("mdi-shield-account")])),_:1})]),default:e(()=>[s(k,null,{default:e(()=>[t(u(n.name),1)]),_:2},1024),s(P,null,{default:e(()=>[c("div",we,[s(E,{size:"x-small",class:"mr-1 mb-1"},{default:e(()=>[t(u(n.permissions?.length||0)+" permissions ",1)]),_:2},1024),c("span",ve,u(n.description||"No description"),1)])]),_:2},1024)]),_:2},1024))),128))]),_:1}))]),_:1})]),_:1}),s(w,{cols:"12",md:"6"},{default:e(()=>[s(L,{title:"Change Password"},{default:e(()=>[s(Q,{onSubmit:W(K,["prevent"])},{default:e(()=>[s(z,{modelValue:o.current_password,"onUpdate:modelValue":l[3]||(l[3]=n=>o.current_password=n),label:"Current Password",type:"password",variant:"outlined",density:"compact","prepend-inner-icon":"mdi-lock","error-messages":a(y).current_password,disabled:a(_),class:"mb-3"},null,8,["modelValue","error-messages","disabled"]),s(z,{modelValue:o.new_password,"onUpdate:modelValue":l[4]||(l[4]=n=>o.new_password=n),label:"New Password",type:"password",variant:"outlined",density:"compact","prepend-inner-icon":"mdi-lock-plus","error-messages":a(y).new_password,disabled:a(_),hint:"Minimum 8 characters","persistent-hint":"",class:"mb-3"},null,8,["modelValue","error-messages","disabled"]),s(z,{modelValue:o.new_password_confirmation,"onUpdate:modelValue":l[5]||(l[5]=n=>o.new_password_confirmation=n),label:"Confirm New Password",type:"password",variant:"outlined",density:"compact","prepend-inner-icon":"mdi-lock-check","error-messages":a(y).new_password_confirmation,disabled:a(_),class:"mb-4"},null,8,["modelValue","error-messages","disabled"]),x.value?(p(),v(F,{key:0,type:"success",variant:"tonal",class:"mb-4"},{default:e(()=>l[28]||(l[28]=[t(" Password changed successfully! ")])),_:1})):D("",!0),a(g)&&!x.value?(p(),v(F,{key:1,type:"error",variant:"tonal",class:"mb-4"},{default:e(()=>[t(u(a(g)),1)]),_:1})):D("",!0),c("div",ge,[s(q,{type:"submit",color:"primary",loading:a(_),disabled:a(_)},{default:e(()=>[s(i,{start:""},{default:e(()=>l[29]||(l[29]=[t("mdi-key")])),_:1}),l[30]||(l[30]=t(" Change Password "))]),_:1},8,["loading","disabled"]),s(q,{variant:"outlined",onClick:j,disabled:a(_)},{default:e(()=>l[31]||(l[31]=[t(" Reset ")])),_:1},8,["disabled"])])]),_:1})]),_:1})]),_:1}),s(w,{cols:"12"},{default:e(()=>[s(L,{title:"Permissions by Resource"},{default:e(()=>[a(U).length===0?(p(),A("div",ye,[s(i,{size:"48",color:"grey"},{default:e(()=>l[32]||(l[32]=[t("mdi-lock-off")])),_:1}),l[33]||(l[33]=c("p",{class:"text-body-1 text-medium-emphasis mt-2"},"No permissions assigned",-1))])):(p(),v(oe,{key:1,variant:"accordion",class:"mt-2"},{default:e(()=>[(p(!0),A(H,null,J(Z.value,n=>(p(),v(ae,{key:n},{default:e(()=>[s(le,null,{default:e(()=>[c("div",be,[s(i,{color:"primary",class:"mr-2"},{default:e(()=>l[34]||(l[34]=[t("mdi-folder")])),_:1}),c("span",xe,u(n),1),s(E,{size:"x-small",class:"ml-2"},{default:e(()=>[t(u(I.value[n].length),1)]),_:2},1024)])]),_:2},1024),s(te,null,{default:e(()=>[s(M,{density:"compact"},{default:e(()=>[(p(!0),A(H,null,J(I.value[n],N=>(p(),v(C,{key:N.id},{prepend:e(()=>[s(i,{color:N.is_active?"success":"error",size:"small",class:"mr-2"},{default:e(()=>[t(u(N.is_active?"mdi-check-circle":"mdi-close-circle"),1)]),_:2},1032,["color"])]),default:e(()=>[s(k,null,{default:e(()=>[t(u(N.name),1)]),_:2},1024),s(P,null,{default:e(()=>[c("div",ke,[s(E,{size:"x-small",variant:"outlined"},{default:e(()=>[t(u(N.action),1)]),_:2},1024),s(E,{size:"x-small",variant:"outlined"},{default:e(()=>[t(u(N.slug),1)]),_:2},1024)]),c("p",Pe,u(N.description||"No description"),1)]),_:2},1024)]),_:2},1024))),128))]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1}))]),_:1})]),_:1})]),_:1})])}}});export{Ne as default};
