var p=Object.defineProperty;var g=(a,e,s)=>e in a?p(a,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):a[e]=s;var n=(a,e,s)=>g(a,typeof e!="symbol"?e+"":e,s);import{E as i,u as h}from"./C8fA-uVv.js";class l{constructor(){n(this,"apiClient");n(this,"chatApiClient");this.apiClient=new i,this.chatApiClient=new i("http://localhost:8006/api")}async sendMessageToUser(e,s,r){try{return await this.chatApiClient.post("/chat/send",{content:e,receiver_type:r,receiver_id:s,message_type:"text"})}catch(t){throw console.error("ChatRepository - sendMessageToUser error:",t),new Error("Failed to send message")}}async getConversation(e,s,r=1,t=50){try{const o=await this.chatApiClient.get(`/chat/conversation?other_user_type=${s}&other_user_id=${e}&page=${r}&per_page=${t}`);return console.log("üîç ChatRepository - getConversation raw response:",o),o}catch(o){throw console.error("ChatRepository - getConversation error:",o),new Error("Failed to fetch conversation")}}async getChats(e=1,s=20){try{const r=await this.chatApiClient.get(`/chats?page=${e}&per_page=${s}`);return console.log("üîç ChatRepository - getChats raw response:",r),r}catch(r){throw console.error("ChatRepository - getChats error:",r),new Error("Failed to fetch chats")}}async getChatMessages(e,s=1,r=50){try{const t=await this.chatApiClient.get(`/chat/${e}/messages?page=${s}&per_page=${r}`);return console.log("üîç ChatRepository - getChatMessages raw response:",t),t}catch(t){throw console.error("ChatRepository - getChatMessages error:",t),new Error("Failed to fetch chat messages")}}async sendMessageToChat(e,s){try{return await this.chatApiClient.post(`/chat/${e}/send`,{content:s,message_type:"text"})}catch(r){throw console.error("ChatRepository - sendMessageToChat error:",r),new Error("Failed to send message")}}async createPrivateChat(e,s){try{return await this.chatApiClient.post("/chat/create-private",{other_user_id:e,other_user_type:s})}catch(r){throw console.error("ChatRepository - createPrivateChat error:",r),new Error("Failed to create private chat")}}async createGroupChat(e,s,r){try{return await this.chatApiClient.post("/chat/create-group",{name:e,description:s,participants:r})}catch(t){throw console.error("ChatRepository - createGroupChat error:",t),new Error("Failed to create group chat")}}async getChannels(){try{return await this.chatApiClient.get("/chat/channels")}catch{throw new Error("Failed to fetch chat channels")}}async markAsRead(e){try{await this.chatApiClient.post(`/chat/channels/${e}/read`)}catch{throw new Error("Failed to mark messages as read")}}async getOnlineUsers(){try{return await this.chatApiClient.get("/chat/users/online")}catch{throw new Error("Failed to fetch online users")}}}class y{constructor(){n(this,"chatRepository");this.chatRepository=new l}async createPrivateChat(e,s){try{const r=await this.chatRepository.createPrivateChat(e,s);if(console.log("üîç ChatService - createPrivateChat response:",r),r.success&&r.data)return r.data;throw new Error("Invalid API response when creating chat")}catch(r){throw console.error("ChatService - createPrivateChat error:",r),r}}async createGroupChat(e,s,r){try{const t=await this.chatRepository.createGroupChat(e,s,r);if(t.success&&t.data)return t.data;throw new Error("Invalid API response when creating group chat")}catch(t){throw console.error("ChatService - createGroupChat error:",t),t}}async sendMessageToUser(e,s,r){try{if(!e.trim())throw new Error("Message cannot be empty");if(e.length>1e3)throw new Error("Message too long (maximum 1000 characters)");const t=await this.chatRepository.sendMessageToUser(e.trim(),s,r);if(t.success&&t.data)return t.data;throw new Error("Invalid API response when sending message to user")}catch(t){throw console.error("ChatService - sendMessageToUser error:",t),t}}async sendMessageToChat(e,s){try{if(!s.trim())throw new Error("Message cannot be empty");if(s.length>1e3)throw new Error("Message too long (maximum 1000 characters)");const r=await this.chatRepository.sendMessageToChat(e,s.trim());if(r.success&&r.data)return r.data;throw new Error("Invalid API response when sending message to chat")}catch(r){throw console.error("ChatService - sendMessageToChat error:",r),r}}async getConversation(e,s,r=1,t=50){try{const o=await this.chatRepository.getConversation(e,s,r,t);if(console.log("üîç ChatService - getConversation response:",o),console.log("üîç ChatService - response type:",typeof o),console.log("üîç ChatService - response keys:",Object.keys(o||{})),o&&typeof o=="object"&&"success"in o&&"data"in o){const c=o;if(c.success&&c.data)return c.data;throw new Error("Invalid API response when fetching conversation")}if(o&&typeof o=="object"&&"messages"in o&&"pagination"in o)return o;throw new Error("Unexpected API response format")}catch(o){throw console.error("ChatService - getConversation error:",o),o}}async getChats(e=1,s=20){try{const r=await this.chatRepository.getChats(e,s);if(console.log("üîç ChatService - getChats response:",r),console.log("üîç ChatService - response type:",typeof r),console.log("üîç ChatService - response keys:",Object.keys(r||{})),r&&typeof r=="object"&&"success"in r&&"data"in r){const t=r;if(t.success&&t.data)return t.data;throw new Error("Invalid API response when fetching chats")}if(r&&typeof r=="object"&&"chats"in r&&"pagination"in r)return r;throw new Error("Unexpected API response format")}catch(r){throw console.error("ChatService - getChats error:",r),r}}async getChatMessages(e,s=1,r=50){try{const t=await this.chatRepository.getChatMessages(e,s,r);if(console.log("üîç ChatService - getChatMessages response:",t),console.log("üîç ChatService - response type:",typeof t),console.log("üîç ChatService - response keys:",Object.keys(t||{})),t&&typeof t=="object"&&"success"in t&&"data"in t){const o=t;if(o.success&&o.data)return o.data;throw new Error("Invalid API response when fetching chat messages")}if(t&&typeof t=="object"&&"messages"in t&&"pagination"in t)return t;throw new Error("Unexpected API response format")}catch(t){throw console.error("ChatService - getChatMessages error:",t),t}}formatMessage(e){const s=h().user.value;let r="--:--";try{if(e.created_at){const t=new Date(e.created_at);isNaN(t.getTime())||(r=t.toLocaleTimeString("pt-BR",{hour:"2-digit",minute:"2-digit"}))}}catch(t){console.warn("Erro ao formatar data da mensagem:",t,e)}return{...e,time:r,isOwn:e.sender_id===(s==null?void 0:s.id),user_name:e.sender_type==="admin"?"Admin":"Usu√°rio"}}validateChat(e){return!!(e.id&&e.type&&["private","group"].includes(e.type))}getChatDisplayName(e){if(!e.name)return e.type==="private"?"Chat Privado":"Chat em Grupo";if(e.type==="private"){const s=h().user.value;if(s&&e.name.includes(s.name))return e.name.replace(`${s.name} - `,"").replace(` - ${s.name}`,"")}return e.name}canSendMessage(e){return!0}}export{y as C};
