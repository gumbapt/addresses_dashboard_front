import{_ as X}from"./DdF__TLh.js";import{x as Se,e as A,l as B,s as Y,d as Fe,v as Pe,f as Re,o as De,c as M,a as e,h as C,w as l,r as f,q as c,g as n,i as S,j as d,t as p,F as pe,m as fe,y as Me,z as Ne,b as w}from"./AmEn0FOG.js";import{u as $e}from"./DBUXSKAd.js";class Le{apiClient;constructor(){this.apiClient=new Se}async getAdmins(r=1,s=15){try{return await this.apiClient.get(`/admins?page=${r}&per_page=${s}`)}catch(_){throw console.error("Get admins failed:",_),new Error("Failed to fetch administrators")}}async createAdmin(r){try{return await this.apiClient.post("/admins",r)}catch(s){throw console.error("Create admin failed:",s),new Error("Failed to create admin")}}async updateAdmin(r){try{return await this.apiClient.put("/admins",r)}catch(s){throw console.error("Update admin failed:",s),new Error("Failed to update admin")}}async deleteAdmin(r){try{return await this.apiClient.deleteWithBody("/admins",r)}catch(s){throw console.error("Delete admin failed:",s),new Error("Failed to delete admin")}}}class ze{adminRepository;constructor(){this.adminRepository=new Le}async getAdmins(r=1,s=15){try{const _=await this.adminRepository.getAdmins(r,s);return{success:_.success,data:_,message:"Administrators loaded successfully"}}catch(_){return{success:!1,error:_ instanceof Error?_.message:"Unknown error"}}}async createAdmin(r){try{const s=await this.adminRepository.createAdmin(r);return{success:s.success,data:s.data,message:"Administrator created successfully"}}catch(s){return{success:!1,error:s instanceof Error?s.message:"Unknown error"}}}async updateAdmin(r){try{const s=await this.adminRepository.updateAdmin(r);return{success:s.success,data:s.data,message:"Administrator updated successfully"}}catch(s){return{success:!1,error:s instanceof Error?s.message:"Unknown error"}}}async deleteAdmin(r){try{const s=await this.adminRepository.deleteAdmin(r);return{success:s.success,data:s.success,message:"Administrator deleted successfully"}}catch(s){return{success:!1,error:s instanceof Error?s.message:"Unknown error"}}}}const je=()=>{const V=A([]),r=A(null),s=A(!1),_=A(null),F=new ze,k=async(i=1,u=15)=>{s.value=!0,_.value=null;try{const g=await F.getAdmins(i,u);g.success&&g.data?(V.value=g.data.data||[],r.value=g.data.pagination||null):(_.value=g.error||"Failed to load administrators",V.value=[])}catch{_.value="Unexpected error loading administrators",V.value=[]}finally{s.value=!1}},Z=()=>{r.value&&r.value.current_page<r.value.last_page&&k(r.value.current_page+1,r.value.per_page)},ee=()=>{r.value&&r.value.current_page>1&&k(r.value.current_page-1,r.value.per_page)},te=i=>{r.value&&i>=1&&i<=r.value.last_page&&k(i,r.value.per_page)},le=i=>{k(1,i)},G=i=>({...i,role:i.is_super_admin?"Super Admin":"Admin",status:i.is_active?"Ativo":"Inativo",statusColor:i.is_active?"success":"error",avatar:`/images/profile/user-${i.id%8+1}.jpg`,phone:`+55 (11) ${String(i.id).padStart(5,"0")}-${String(i.id).padStart(4,"0")}`,department:"Administração",lastLogin:i.last_login_at?new Date(i.last_login_at).toLocaleDateString("pt-BR"):"Nunca"}),ae=B(()=>!V.value||!Array.isArray(V.value)?[]:V.value.map(G)),se=B(()=>r.value&&r.value.current_page<r.value.last_page),re=B(()=>r.value&&r.value.current_page>1),oe=B(()=>{if(!r.value)return[];const i=[],u=r.value.current_page,g=r.value.last_page;let P=Math.max(1,u-2),R=Math.min(g,u+2);u<=3?R=Math.min(g,5):u>=g-2&&(P=Math.max(1,g-4));for(let h=P;h<=R;h++)i.push(h);return i}),ne=async i=>{try{return await F.createAdmin(i)}catch(u){return{success:!1,error:u instanceof Error?u.message:"Failed to create admin"}}},N=async i=>{try{return await F.updateAdmin(i)}catch(u){return{success:!1,error:u instanceof Error?u.message:"Failed to update admin"}}},T=async i=>{try{return await F.deleteAdmin({id:i})}catch(u){return{success:!1,error:u instanceof Error?u.message:"Failed to delete admin"}}};return{admins:Y(V),pagination:Y(r),loading:Y(s),error:Y(_),formattedAdmins:ae,canGoNext:se,canGoPrev:re,pageNumbers:oe,loadAdmins:k,nextPage:Z,prevPage:ee,goToPage:te,changePerPage:le,formatAdminForDisplay:G,createAdmin:ne,updateAdmin:N,deleteAdmin:T}},qe={class:"d-flex align-center justify-space-between"},Be={class:"d-flex gap-2"},Ge={class:"d-flex justify-center align-center py-8"},Te={class:"d-flex align-center"},Ie=["src","alt"],Oe={class:"font-weight-medium"},We={class:"text-caption text-medium-emphasis"},He={class:"d-flex justify-center gap-1"},Je={key:0,class:"d-flex justify-end mt-4"},Ke={class:"text-body-2 text-medium-emphasis"},Qe={key:1,class:"d-flex align-center justify-space-between mt-4"},Xe={class:"text-body-2 text-medium-emphasis"},Ye={class:"d-flex align-center gap-2"},Ze={class:"d-flex gap-1"},et={class:"text-caption"},st=Fe({__name:"index",setup(V){const{formattedAdmins:r,pagination:s,loading:_,error:F,loadAdmins:k,nextPage:Z,prevPage:ee,goToPage:te,changePerPage:le,canGoNext:G,canGoPrev:ae,pageNumbers:se,createAdmin:re,updateAdmin:oe,deleteAdmin:ne}=je(),{formattedRoles:N,loadRoles:T}=$e(),{hasPermission:i}=Pe(),u=Re(),g=A(""),P=A("all"),R=A("all"),h=A(!1),$=A(!1),L=A(!1),U=A(null),ie=A(!1),_e=A(null),m=A({name:"",email:"",password:"",password_confirmation:"",is_active:!0,role_id:null}),x=A(!1),b=A(null),ge=[{value:"all",label:"All Status"},{value:"Ativo",label:"Active"},{value:"Inativo",label:"Inactive"}],ye=[{value:"all",label:"All Roles"},{value:"Super Admin",label:"Super Admin"},{value:"Admin",label:"Admin"}],de=B(()=>r.value.filter(o=>{const t=o.name.toLowerCase().includes(g.value.toLowerCase())||o.email.toLowerCase().includes(g.value.toLowerCase()),y=P.value==="all"||o.status===P.value,v=R.value==="all"||o.role===R.value;return t&&y&&v})),we=async()=>{i("admin-create")&&(m.value={name:"",email:"",password:"",password_confirmation:"",is_active:!0,role_id:null},N.value.length===0&&await T(),h.value=!0)},Ae=async o=>{i("admin-update")&&(U.value={...o},m.value={name:o.name,email:o.email,password:"",password_confirmation:"",is_active:o.is_active,role_id:null},N.value.length===0&&await T(),$.value=!0)},xe=o=>{i("admin-delete")&&(U.value=o,L.value=!0)},ce=async()=>{x.value=!0,b.value=null;try{if(U.value){const o={id:U.value.id,name:m.value.name,email:m.value.email,is_active:m.value.is_active},t=await oe(o);t.success?($.value=!1,u.success("User updated successfully"),await k(s.value?.current_page||1,s.value?.per_page||15)):(b.value=t.error||"Failed to update user",u.error(t.error||"Failed to update user"))}else{const o=await re(m.value);o.success?(h.value=!1,u.success("User created successfully"),await k(s.value?.current_page||1,s.value?.per_page||15)):(b.value=o.error||"Failed to create user",u.error(o.error||"Failed to create user"))}}catch(o){b.value=o instanceof Error?o.message:"Unexpected error",u.error(o instanceof Error?o.message:"Unexpected error")}finally{x.value=!1}},be=async()=>{if(U.value){x.value=!0,b.value=null;try{const o=await ne(U.value.id);o.success?(L.value=!1,U.value=null,u.success("User deleted successfully"),await k(s.value?.current_page||1,s.value?.per_page||15)):(b.value=o.error||"Failed to delete user",u.error(o.error||"Failed to delete user"))}catch(o){b.value=o instanceof Error?o.message:"Unexpected error",u.error(o instanceof Error?o.message:"Unexpected error")}finally{x.value=!1}}},Ce=o=>{i("admin-update")&&(o.status==="Active"?(o.status="Inactive",o.statusColor="error"):(o.status="Active",o.statusColor="success"))},Ve=()=>{g.value="",P.value="all",R.value="all"};return De(()=>{k()}),(o,t)=>{const y=f("v-btn"),v=f("v-col"),E=f("v-row"),D=f("v-text-field"),I=f("v-select"),ue=f("v-chip"),ke=f("v-progress-circular"),z=f("v-alert"),he=f("v-avatar"),j=f("v-icon"),Ue=f("v-table"),O=f("v-card-title"),Ee=f("v-list-item"),me=f("v-switch"),ve=f("v-form"),W=f("v-card-text"),H=f("v-spacer"),J=f("v-card-actions"),K=f("v-card"),Q=f("v-dialog");return w(),M("div",null,[e(E,{class:"mb-4"},{default:l(()=>[e(v,{cols:"12"},{default:l(()=>[n("div",qe,[t[21]||(t[21]=n("div",null,[n("h1",{class:"text-h4 font-weight-bold"},"Users"),n("p",{class:"text-body-1 text-medium-emphasis"}," Manage all system users ")],-1)),c(i)("admin-create")?(w(),C(y,{key:0,color:"primary","prepend-icon":"mdi-plus",onClick:we,size:"large"},{default:l(()=>t[20]||(t[20]=[d(" Add User ")])),_:1})):S("",!0)])]),_:1})]),_:1}),e(E,{class:"mb-6"},{default:l(()=>[e(v,{cols:"12"},{default:l(()=>[e(X,{title:"Filters"},{default:l(()=>[e(E,null,{default:l(()=>[e(v,{cols:"12",md:"4"},{default:l(()=>[e(D,{modelValue:g.value,"onUpdate:modelValue":t[0]||(t[0]=a=>g.value=a),label:"Search by name or email","prepend-inner-icon":"mdi-magnify",variant:"outlined",density:"compact",clearable:""},null,8,["modelValue"])]),_:1}),e(v,{cols:"12",md:"4"},{default:l(()=>[e(I,{modelValue:P.value,"onUpdate:modelValue":t[1]||(t[1]=a=>P.value=a),items:ge,"item-title":"label","item-value":"value",label:"Status",variant:"outlined",density:"compact"},null,8,["modelValue"])]),_:1}),e(v,{cols:"12",md:"4"},{default:l(()=>[e(I,{modelValue:R.value,"onUpdate:modelValue":t[2]||(t[2]=a=>R.value=a),items:ye,"item-title":"label","item-value":"value",label:"Role",variant:"outlined",density:"compact"},null,8,["modelValue"])]),_:1})]),_:1}),e(E,null,{default:l(()=>[e(v,{cols:"12"},{default:l(()=>[n("div",Be,[e(y,{variant:"outlined",onClick:Ve,"prepend-icon":"mdi-refresh"},{default:l(()=>t[22]||(t[22]=[d(" Clear Filters ")])),_:1}),e(ue,{color:"primary",variant:"tonal",class:"ml-auto"},{default:l(()=>[d(p(de.value.length)+" users found ",1)]),_:1})])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),c(_)?(w(),C(E,{key:0},{default:l(()=>[e(v,{cols:"12"},{default:l(()=>[e(X,null,{default:l(()=>[n("div",Ge,[e(ke,{indeterminate:"",color:"primary",size:"64"})])]),_:1})]),_:1})]),_:1})):c(F)?(w(),C(E,{key:1},{default:l(()=>[e(v,{cols:"12"},{default:l(()=>[e(X,null,{default:l(()=>[e(z,{type:"error",variant:"tonal",class:"mb-0"},{default:l(()=>[d(p(c(F)),1)]),_:1})]),_:1})]),_:1})]),_:1})):(w(),C(E,{key:2},{default:l(()=>[e(v,{cols:"12"},{default:l(()=>[e(X,{title:"Users List"},{default:l(()=>[e(Ue,{"fixed-header":"",height:"600px"},{default:l(()=>[t[25]||(t[25]=n("thead",null,[n("tr",null,[n("th",{class:"text-left"},"User"),n("th",{class:"text-left"},"Email"),n("th",{class:"text-left"},"Role"),n("th",{class:"text-left"},"Status"),n("th",{class:"text-left"},"Last Login"),n("th",{class:"text-center"},"Actions")])],-1)),n("tbody",null,[(w(!0),M(pe,null,fe(de.value,a=>(w(),M("tr",{key:a.id},[n("td",null,[n("div",Te,[e(he,{size:"40",class:"mr-3"},{default:l(()=>[n("img",{src:a.avatar,alt:a.name},null,8,Ie)]),_:2},1024),n("div",null,[n("div",Oe,p(a.name),1),n("div",We,p(a.phone),1)])])]),n("td",null,p(a.email),1),n("td",null,[e(ue,{color:a.role==="Super Admin"?"error":"primary",variant:"tonal",size:"small"},{default:l(()=>[d(p(a.role),1)]),_:2},1032,["color"])]),n("td",null,[e(ue,{color:a.statusColor,variant:"tonal",size:"small"},{default:l(()=>[d(p(a.status),1)]),_:2},1032,["color"])]),n("td",null,p(a.lastLogin),1),n("td",null,[n("div",He,[c(i)("admin-update")?(w(),C(y,{key:0,icon:"",size:"small",variant:"text",color:"primary",onClick:q=>Ae(a),title:"Edit"},{default:l(()=>[e(j,null,{default:l(()=>t[23]||(t[23]=[d("mdi-pencil")])),_:1})]),_:2},1032,["onClick"])):S("",!0),c(i)("admin-update")?(w(),C(y,{key:1,icon:"",size:"small",variant:"text",color:a.status==="Active"?"warning":"success",onClick:q=>Ce(a),title:a.status==="Active"?"Deactivate":"Activate"},{default:l(()=>[e(j,null,{default:l(()=>[d(p(a.status==="Active"?"mdi-account-off":"mdi-account-check"),1)]),_:2},1024)]),_:2},1032,["color","onClick","title"])):S("",!0),c(i)("admin-delete")?(w(),C(y,{key:2,icon:"",size:"small",variant:"text",color:"error",onClick:q=>xe(a),title:"Delete"},{default:l(()=>[e(j,null,{default:l(()=>t[24]||(t[24]=[d("mdi-delete")])),_:1})]),_:2},1032,["onClick"])):S("",!0)])])]))),128))])]),_:1}),c(s)&&c(s).last_page===1?(w(),M("div",Je,[n("div",Ke," Total: "+p(c(s).total)+" users ",1)])):S("",!0),c(s)&&c(s).last_page>1?(w(),M("div",Qe,[n("div",Xe," Showing "+p(c(s).from)+" to "+p(c(s).to)+" of "+p(c(s).total)+" users ",1),n("div",Ye,[e(I,{"model-value":c(s).per_page,"onUpdate:modelValue":c(le),items:[10,15,25,50],variant:"outlined",density:"compact","hide-details":"",style:{width:"80px"}},null,8,["model-value","onUpdate:modelValue"]),e(y,{icon:"",variant:"text",disabled:!c(ae),onClick:c(ee),title:"Previous page"},{default:l(()=>[e(j,null,{default:l(()=>t[26]||(t[26]=[d("mdi-chevron-left")])),_:1})]),_:1},8,["disabled","onClick"]),n("div",Ze,[(w(!0),M(pe,null,fe(c(se),a=>(w(),C(y,{key:a,color:a===c(s).current_page?"primary":void 0,variant:"text",size:"small",onClick:q=>c(te)(a)},{default:l(()=>[d(p(a),1)]),_:2},1032,["color","onClick"]))),128))]),e(y,{icon:"",variant:"text",disabled:!c(G),onClick:c(Z),title:"Next page"},{default:l(()=>[e(j,null,{default:l(()=>t[27]||(t[27]=[d("mdi-chevron-right")])),_:1})]),_:1},8,["disabled","onClick"])])])):S("",!0)]),_:1})]),_:1})]),_:1})),e(Q,{modelValue:h.value,"onUpdate:modelValue":t[10]||(t[10]=a=>h.value=a),"max-width":"600px",scrollable:""},{default:l(()=>[e(K,null,{default:l(()=>[e(O,null,{default:l(()=>t[28]||(t[28]=[d("Create User")])),_:1}),e(W,null,{default:l(()=>[e(ve,null,{default:l(()=>[e(E,null,{default:l(()=>[e(v,{cols:"12"},{default:l(()=>[e(D,{modelValue:m.value.name,"onUpdate:modelValue":t[3]||(t[3]=a=>m.value.name=a),label:"Name",variant:"outlined",required:"",placeholder:"User Name"},null,8,["modelValue"])]),_:1}),e(v,{cols:"12"},{default:l(()=>[e(D,{modelValue:m.value.email,"onUpdate:modelValue":t[4]||(t[4]=a=>m.value.email=a),label:"Email",variant:"outlined",required:"",type:"email",placeholder:"user@example.com"},null,8,["modelValue"])]),_:1}),e(v,{cols:"12"},{default:l(()=>[e(D,{modelValue:m.value.password,"onUpdate:modelValue":t[5]||(t[5]=a=>m.value.password=a),label:"Password",variant:"outlined",required:"",type:"password",placeholder:"Minimum 8 characters"},null,8,["modelValue"])]),_:1}),e(v,{cols:"12"},{default:l(()=>[e(D,{modelValue:m.value.password_confirmation,"onUpdate:modelValue":t[6]||(t[6]=a=>m.value.password_confirmation=a),label:"Confirm Password",variant:"outlined",required:"",type:"password",placeholder:"Re-enter password"},null,8,["modelValue"])]),_:1}),e(v,{cols:"12"},{default:l(()=>[e(I,{modelValue:m.value.role_id,"onUpdate:modelValue":t[7]||(t[7]=a=>m.value.role_id=a),items:c(N),"item-title":"name","item-value":"id",label:"Role (Optional)",variant:"outlined",clearable:"",placeholder:"Select a role"},{item:l(({props:a,item:q})=>[e(Ee,Me(Ne(a)),{subtitle:l(()=>[n("span",et,p(q.raw.permissionsCount)+" permissions",1)]),_:2},1040)]),_:1},8,["modelValue","items"])]),_:1}),e(v,{cols:"12"},{default:l(()=>[e(me,{modelValue:m.value.is_active,"onUpdate:modelValue":t[8]||(t[8]=a=>m.value.is_active=a),label:"Active",color:"primary","hide-details":""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),e(J,null,{default:l(()=>[e(H),b.value?(w(),C(z,{key:0,type:"error",variant:"tonal",density:"compact",class:"mr-4"},{default:l(()=>[d(p(b.value),1)]),_:1})):S("",!0),e(y,{onClick:t[9]||(t[9]=a=>h.value=!1),disabled:x.value},{default:l(()=>t[29]||(t[29]=[d("Cancel")])),_:1},8,["disabled"]),e(y,{color:"primary",onClick:ce,loading:x.value,disabled:x.value},{default:l(()=>t[30]||(t[30]=[d("Create")])),_:1},8,["loading","disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(Q,{modelValue:$.value,"onUpdate:modelValue":t[15]||(t[15]=a=>$.value=a),"max-width":"600px",scrollable:""},{default:l(()=>[e(K,null,{default:l(()=>[e(O,null,{default:l(()=>[d("Edit User: "+p(U.value?.name),1)]),_:1}),e(W,null,{default:l(()=>[e(ve,null,{default:l(()=>[e(E,null,{default:l(()=>[e(v,{cols:"12"},{default:l(()=>[e(D,{modelValue:m.value.name,"onUpdate:modelValue":t[11]||(t[11]=a=>m.value.name=a),label:"Name",variant:"outlined",required:""},null,8,["modelValue"])]),_:1}),e(v,{cols:"12"},{default:l(()=>[e(D,{modelValue:m.value.email,"onUpdate:modelValue":t[12]||(t[12]=a=>m.value.email=a),label:"Email",variant:"outlined",required:"",type:"email"},null,8,["modelValue"])]),_:1}),e(v,{cols:"12"},{default:l(()=>[e(me,{modelValue:m.value.is_active,"onUpdate:modelValue":t[13]||(t[13]=a=>m.value.is_active=a),label:"Active",color:"primary","hide-details":""},null,8,["modelValue"])]),_:1}),e(v,{cols:"12"},{default:l(()=>[e(z,{type:"info",variant:"tonal",density:"compact"},{default:l(()=>t[31]||(t[31]=[n("div",{class:"text-caption"},"Leave password fields empty to keep current password",-1)])),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),e(J,null,{default:l(()=>[e(H),b.value?(w(),C(z,{key:0,type:"error",variant:"tonal",density:"compact",class:"mr-4"},{default:l(()=>[d(p(b.value),1)]),_:1})):S("",!0),e(y,{onClick:t[14]||(t[14]=a=>$.value=!1),disabled:x.value},{default:l(()=>t[32]||(t[32]=[d("Cancel")])),_:1},8,["disabled"]),e(y,{color:"primary",onClick:ce,loading:x.value,disabled:x.value},{default:l(()=>t[33]||(t[33]=[d("Save Changes")])),_:1},8,["loading","disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(Q,{modelValue:L.value,"onUpdate:modelValue":t[17]||(t[17]=a=>L.value=a),"max-width":"400px"},{default:l(()=>[e(K,null,{default:l(()=>[e(O,null,{default:l(()=>t[34]||(t[34]=[d("Confirm Deletion")])),_:1}),e(W,null,{default:l(()=>[t[35]||(t[35]=n("p",null,"Are you sure you want to delete this user?",-1)),n("p",null,[n("strong",null,p(U.value?.name),1)]),b.value?(w(),C(z,{key:0,type:"error",variant:"tonal",density:"compact",class:"mt-4"},{default:l(()=>[d(p(b.value),1)]),_:1})):S("",!0)]),_:1}),e(J,null,{default:l(()=>[e(H),e(y,{onClick:t[16]||(t[16]=a=>L.value=!1),disabled:x.value},{default:l(()=>t[36]||(t[36]=[d("Cancel")])),_:1},8,["disabled"]),e(y,{color:"error",onClick:be,loading:x.value,disabled:x.value},{default:l(()=>t[37]||(t[37]=[d("Delete")])),_:1},8,["loading","disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(Q,{modelValue:ie.value,"onUpdate:modelValue":t[19]||(t[19]=a=>ie.value=a),"max-width":"800px"},{default:l(()=>[e(K,null,{default:l(()=>[e(O,null,{default:l(()=>[d("Chat with "+p(_e.value?.name),1)]),_:1}),e(W,null,{default:l(()=>t[38]||(t[38]=[n("p",null,"Chat interface with the user...",-1)])),_:1}),e(J,null,{default:l(()=>[e(H),e(y,{onClick:t[18]||(t[18]=a=>ie.value=!1)},{default:l(()=>t[39]||(t[39]=[d("Close")])),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])])}}});export{st as default};
