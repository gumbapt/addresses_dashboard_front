import{x as U,e as u,l as i,s as g}from"./AmEn0FOG.js";class P{apiClient;constructor(){this.apiClient=new U}async getReports(e){try{const r=new URLSearchParams;e?.page&&r.append("page",e.page.toString()),e?.per_page&&r.append("per_page",e.per_page.toString()),e?.domain_id&&r.append("domain_id",e.domain_id.toString()),e?.status&&r.append("status",e.status),e?.start_date&&r.append("start_date",e.start_date),e?.end_date&&r.append("end_date",e.end_date);const s=r.toString(),c=`/reports${s?"?"+s:""}`;return await this.apiClient.get(c)}catch(r){throw console.error("Get reports failed:",r),new Error("Failed to fetch reports")}}async getReport(e){try{return await this.apiClient.get(`/reports/${e}`)}catch(r){throw console.error("Get report failed:",r),new Error("Failed to fetch report")}}async getRecentReports(){try{return await this.apiClient.get("/reports/recent")}catch(e){throw console.error("Get recent reports failed:",e),new Error("Failed to fetch recent reports")}}async getGlobalDomainRanking(e){try{let r="/reports/global/domain-ranking";return e&&(r+=`?sort_by=${e}`),await this.apiClient.get(r)}catch(r){throw console.error("Get global domain ranking failed:",r),new Error("Failed to fetch global domain ranking")}}async compareDomains(e,r,s,c){try{const o=new URLSearchParams;o.append("domains",e.join(",")),r&&o.append("metric",r),s&&o.append("date_from",s),c&&o.append("date_to",c);const l=`/reports/global/comparison?${o.toString()}`;return await this.apiClient.get(l)}catch(o){throw console.error("Compare domains failed:",o),new Error("Failed to compare domains")}}}class E{reportRepository;constructor(){this.reportRepository=new P}async getReports(e){try{const r=await this.reportRepository.getReports(e);return{success:r.success,data:r,message:"Reports loaded successfully"}}catch(r){return{success:!1,error:r instanceof Error?r.message:"Unknown error"}}}async getReport(e){try{const r=await this.reportRepository.getReport(e);return{success:r.success,data:r.data,message:"Report loaded successfully"}}catch(r){return{success:!1,error:r instanceof Error?r.message:"Unknown error"}}}async getRecentReports(){try{const e=await this.reportRepository.getRecentReports();return{success:e.success,data:e.data,message:"Recent reports loaded successfully"}}catch(e){return{success:!1,error:e instanceof Error?e.message:"Unknown error"}}}async getGlobalDomainRanking(e){try{const r=await this.reportRepository.getGlobalDomainRanking(e);return{success:r.success,data:r.data,message:"Global domain ranking loaded successfully"}}catch(r){return{success:!1,error:r instanceof Error?r.message:"Unknown error"}}}async compareDomains(e,r,s,c){try{const o=await this.reportRepository.compareDomains(e,r,s,c);return{success:o.success,data:o.data,message:"Domain comparison loaded successfully"}}catch(o){return{success:!1,error:o instanceof Error?o.message:"Unknown error"}}}}const x=()=>{const n=u([]),e=u(null),r=u(!1),s=u(null),c=new E,o=async a=>{r.value=!0,s.value=null;try{const t=await c.getReports(a);t.success&&t.data?(n.value=t.data.data||[],e.value=t.data.meta||null):(s.value=t.error||"Failed to load reports",n.value=[])}catch{s.value="Unexpected error loading reports",n.value=[]}finally{r.value=!1}},l=async a=>{r.value=!0,s.value=null;try{const t=await c.getReport(a);return t.success&&t.data?t.data:(s.value=t.error||"Failed to load report",null)}catch{return s.value="Unexpected error loading report",null}finally{r.value=!1}},m=async()=>{r.value=!0,s.value=null;try{const a=await c.getRecentReports();a.success&&a.data?n.value=a.data||[]:(s.value=a.error||"Failed to load recent reports",n.value=[])}catch{s.value="Unexpected error loading recent reports",n.value=[]}finally{r.value=!1}},w=a=>{e.value&&e.value.current_page<e.value.last_page&&o({...a,page:e.value.current_page+1,per_page:e.value.per_page})},_=a=>{e.value&&e.value.current_page>1&&o({...a,page:e.value.current_page-1,per_page:e.value.per_page})},S=(a,t)=>{e.value&&a>=1&&a<=e.value.last_page&&o({...t,page:a,per_page:e.value.per_page})},b=(a,t)=>{o({...t,page:1,per_page:a})},f=a=>({pending:"warning",processing:"info",processed:"success",failed:"error"})[a]||"default",v=a=>({pending:"Pending",processing:"Processing",processed:"Processed",failed:"Failed"})[a]||a,y=a=>({...a,statusColor:f(a.status),statusLabel:v(a.status),reportDate:new Date(a.report_date).toLocaleDateString("en-US"),createdDate:new Date(a.created_at).toLocaleDateString("en-US"),domainName:a.domain?.name||"N/A"}),D=i(()=>!n.value||!Array.isArray(n.value)?[]:n.value.map(y)),M=i(()=>e.value&&e.value.current_page<e.value.last_page),C=i(()=>e.value&&e.value.current_page>1),k=i(()=>{if(!e.value)return[];const a=[],t=e.value.current_page,p=e.value.last_page;let h=Math.max(1,t-2),R=Math.min(p,t+2);t<=3?R=Math.min(p,5):t>=p-2&&(h=Math.max(1,p-4));for(let d=h;d<=R;d++)a.push(d);return a});return{reports:g(n),meta:g(e),loading:g(r),error:g(s),formattedReports:D,canGoNext:M,canGoPrev:C,pageNumbers:k,loadReports:o,loadReport:l,loadRecentReports:m,nextPage:w,prevPage:_,goToPage:S,changePerPage:b,formatReportForDisplay:y,getStatusColor:f,getStatusLabel:v}};export{E as R,x as u};
