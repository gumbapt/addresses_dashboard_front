var Fe=Object.defineProperty;var Pe=(x,r,s)=>r in x?Fe(x,r,{enumerable:!0,configurable:!0,writable:!0,value:s}):x[r]=s;var de=(x,r,s)=>Pe(x,typeof r!="symbol"?r+"":r,s);import{_ as X}from"./EaG_mXkB.js";import{x as Re,e as b,l as B,s as Y,d as De,v as Me,f as Ne,o as $e,c as M,a as e,h,w as l,r as g,q as c,g as o,i as F,j as d,t as f,F as fe,m as _e,y as Le,z as ze,b as A}from"./o31YAp6d.js";import{u as je}from"./Bp_l2Nmp.js";class qe{constructor(){de(this,"apiClient");this.apiClient=new Re}async getAdmins(r=1,s=15){try{return await this.apiClient.get(`/admins?page=${r}&per_page=${s}`)}catch(y){throw console.error("Get admins failed:",y),new Error("Failed to fetch administrators")}}async createAdmin(r){try{return await this.apiClient.post("/admins",r)}catch(s){throw console.error("Create admin failed:",s),new Error("Failed to create admin")}}async updateAdmin(r){try{return await this.apiClient.put("/admins",r)}catch(s){throw console.error("Update admin failed:",s),new Error("Failed to update admin")}}async deleteAdmin(r){try{return await this.apiClient.deleteWithBody("/admins",r)}catch(s){throw console.error("Delete admin failed:",s),new Error("Failed to delete admin")}}}class Be{constructor(){de(this,"adminRepository");this.adminRepository=new qe}async getAdmins(r=1,s=15){try{const y=await this.adminRepository.getAdmins(r,s);return{success:y.success,data:y,message:"Administrators loaded successfully"}}catch(y){return{success:!1,error:y instanceof Error?y.message:"Unknown error"}}}async createAdmin(r){try{const s=await this.adminRepository.createAdmin(r);return{success:s.success,data:s.data,message:"Administrator created successfully"}}catch(s){return{success:!1,error:s instanceof Error?s.message:"Unknown error"}}}async updateAdmin(r){try{const s=await this.adminRepository.updateAdmin(r);return{success:s.success,data:s.data,message:"Administrator updated successfully"}}catch(s){return{success:!1,error:s instanceof Error?s.message:"Unknown error"}}}async deleteAdmin(r){try{const s=await this.adminRepository.deleteAdmin(r);return{success:s.success,data:s.success,message:"Administrator deleted successfully"}}catch(s){return{success:!1,error:s instanceof Error?s.message:"Unknown error"}}}}const Ge=()=>{const x=b([]),r=b(null),s=b(!1),y=b(null),P=new Be,U=async(n=1,u=15)=>{s.value=!0,y.value=null;try{const w=await P.getAdmins(n,u);w.success&&w.data?(x.value=w.data.data||[],r.value=w.data.pagination||null):(y.value=w.error||"Failed to load administrators",x.value=[])}catch{y.value="Unexpected error loading administrators",x.value=[]}finally{s.value=!1}},Z=()=>{r.value&&r.value.current_page<r.value.last_page&&U(r.value.current_page+1,r.value.per_page)},ee=()=>{r.value&&r.value.current_page>1&&U(r.value.current_page-1,r.value.per_page)},te=n=>{r.value&&n>=1&&n<=r.value.last_page&&U(n,r.value.per_page)},le=n=>{U(1,n)},G=n=>({...n,role:n.is_super_admin?"Super Admin":"Admin",status:n.is_active?"Ativo":"Inativo",statusColor:n.is_active?"success":"error",avatar:`/images/profile/user-${n.id%8+1}.jpg`,phone:`+55 (11) ${String(n.id).padStart(5,"0")}-${String(n.id).padStart(4,"0")}`,department:"Administração",lastLogin:n.last_login_at?new Date(n.last_login_at).toLocaleDateString("pt-BR"):"Nunca"}),ae=B(()=>!x.value||!Array.isArray(x.value)?[]:x.value.map(G)),se=B(()=>r.value&&r.value.current_page<r.value.last_page),re=B(()=>r.value&&r.value.current_page>1),oe=B(()=>{if(!r.value)return[];const n=[],u=r.value.current_page,w=r.value.last_page;let R=Math.max(1,u-2),D=Math.min(w,u+2);u<=3?D=Math.min(w,5):u>=w-2&&(R=Math.max(1,w-4));for(let E=R;E<=D;E++)n.push(E);return n}),ne=async n=>{try{return await P.createAdmin(n)}catch(u){return{success:!1,error:u instanceof Error?u.message:"Failed to create admin"}}},N=async n=>{try{return await P.updateAdmin(n)}catch(u){return{success:!1,error:u instanceof Error?u.message:"Failed to update admin"}}},T=async n=>{try{return await P.deleteAdmin({id:n})}catch(u){return{success:!1,error:u instanceof Error?u.message:"Failed to delete admin"}}};return{admins:Y(x),pagination:Y(r),loading:Y(s),error:Y(y),formattedAdmins:ae,canGoNext:se,canGoPrev:re,pageNumbers:oe,loadAdmins:U,nextPage:Z,prevPage:ee,goToPage:te,changePerPage:le,formatAdminForDisplay:G,createAdmin:ne,updateAdmin:N,deleteAdmin:T}},Te={class:"d-flex align-center justify-space-between"},Ie={class:"d-flex gap-2"},Oe={class:"d-flex justify-center align-center py-8"},We={class:"d-flex align-center"},He=["src","alt"],Je={class:"font-weight-medium"},Ke={class:"text-caption text-medium-emphasis"},Qe={class:"d-flex justify-center gap-1"},Xe={key:0,class:"d-flex justify-end mt-4"},Ye={class:"text-body-2 text-medium-emphasis"},Ze={key:1,class:"d-flex align-center justify-space-between mt-4"},et={class:"text-body-2 text-medium-emphasis"},tt={class:"d-flex align-center gap-2"},lt={class:"d-flex gap-1"},at={class:"text-caption"},it=De({__name:"index",setup(x){const{formattedAdmins:r,pagination:s,loading:y,error:P,loadAdmins:U,nextPage:Z,prevPage:ee,goToPage:te,changePerPage:le,canGoNext:G,canGoPrev:ae,pageNumbers:se,createAdmin:re,updateAdmin:oe,deleteAdmin:ne}=Ge(),{formattedRoles:N,loadRoles:T}=je(),{hasPermission:n}=Me(),u=Ne(),w=b(""),R=b("all"),D=b("all"),E=b(!1),$=b(!1),L=b(!1),S=b(null),ie=b(!1),ge=b(null),m=b({name:"",email:"",password:"",password_confirmation:"",is_active:!0,role_id:null}),C=b(!1),V=b(null),ye=[{value:"all",label:"All Status"},{value:"Ativo",label:"Active"},{value:"Inativo",label:"Inactive"}],we=[{value:"all",label:"All Roles"},{value:"Super Admin",label:"Super Admin"},{value:"Admin",label:"Admin"}],ce=B(()=>r.value.filter(v=>{const t=v.name.toLowerCase().includes(w.value.toLowerCase())||v.email.toLowerCase().includes(w.value.toLowerCase()),i=R.value==="all"||v.status===R.value,p=D.value==="all"||v.role===D.value;return t&&i&&p})),Ae=async()=>{n("admin-create")&&(m.value={name:"",email:"",password:"",password_confirmation:"",is_active:!0,role_id:null},N.value.length===0&&await T(),E.value=!0)},xe=async v=>{n("admin-update")&&(S.value={...v},m.value={name:v.name,email:v.email,password:"",password_confirmation:"",is_active:v.is_active,role_id:null},N.value.length===0&&await T(),$.value=!0)},be=v=>{n("admin-delete")&&(S.value=v,L.value=!0)},me=async()=>{var v,t,i,p;C.value=!0,V.value=null;try{if(S.value){const _={id:S.value.id,name:m.value.name,email:m.value.email,is_active:m.value.is_active},k=await oe(_);k.success?($.value=!1,u.success("User updated successfully"),await U(((v=s.value)==null?void 0:v.current_page)||1,((t=s.value)==null?void 0:t.per_page)||15)):(V.value=k.error||"Failed to update user",u.error(k.error||"Failed to update user"))}else{const _=await re(m.value);_.success?(E.value=!1,u.success("User created successfully"),await U(((i=s.value)==null?void 0:i.current_page)||1,((p=s.value)==null?void 0:p.per_page)||15)):(V.value=_.error||"Failed to create user",u.error(_.error||"Failed to create user"))}}catch(_){V.value=_ instanceof Error?_.message:"Unexpected error",u.error(_ instanceof Error?_.message:"Unexpected error")}finally{C.value=!1}},Ce=async()=>{var v,t;if(S.value){C.value=!0,V.value=null;try{const i=await ne(S.value.id);i.success?(L.value=!1,S.value=null,u.success("User deleted successfully"),await U(((v=s.value)==null?void 0:v.current_page)||1,((t=s.value)==null?void 0:t.per_page)||15)):(V.value=i.error||"Failed to delete user",u.error(i.error||"Failed to delete user"))}catch(i){V.value=i instanceof Error?i.message:"Unexpected error",u.error(i instanceof Error?i.message:"Unexpected error")}finally{C.value=!1}}},Ve=v=>{n("admin-update")&&(v.status==="Active"?(v.status="Inactive",v.statusColor="error"):(v.status="Active",v.statusColor="success"))},ke=()=>{w.value="",R.value="all",D.value="all"};return $e(()=>{U()}),(v,t)=>{const i=g("v-btn"),p=g("v-col"),_=g("v-row"),k=g("v-text-field"),I=g("v-select"),ue=g("v-chip"),he=g("v-progress-circular"),z=g("v-alert"),Ue=g("v-avatar"),j=g("v-icon"),Ee=g("v-table"),O=g("v-card-title"),Se=g("v-list-item"),ve=g("v-switch"),pe=g("v-form"),W=g("v-card-text"),H=g("v-spacer"),J=g("v-card-actions"),K=g("v-card"),Q=g("v-dialog");return A(),M("div",null,[e(_,{class:"mb-4"},{default:l(()=>[e(p,{cols:"12"},{default:l(()=>[o("div",Te,[t[21]||(t[21]=o("div",null,[o("h1",{class:"text-h4 font-weight-bold"},"Users"),o("p",{class:"text-body-1 text-medium-emphasis"}," Manage all system users ")],-1)),c(n)("admin-create")?(A(),h(i,{key:0,color:"primary","prepend-icon":"mdi-plus",onClick:Ae,size:"large"},{default:l(()=>t[20]||(t[20]=[d(" Add User ")])),_:1})):F("",!0)])]),_:1})]),_:1}),e(_,{class:"mb-6"},{default:l(()=>[e(p,{cols:"12"},{default:l(()=>[e(X,{title:"Filters"},{default:l(()=>[e(_,null,{default:l(()=>[e(p,{cols:"12",md:"4"},{default:l(()=>[e(k,{modelValue:w.value,"onUpdate:modelValue":t[0]||(t[0]=a=>w.value=a),label:"Search by name or email","prepend-inner-icon":"mdi-magnify",variant:"outlined",density:"compact",clearable:""},null,8,["modelValue"])]),_:1}),e(p,{cols:"12",md:"4"},{default:l(()=>[e(I,{modelValue:R.value,"onUpdate:modelValue":t[1]||(t[1]=a=>R.value=a),items:ye,"item-title":"label","item-value":"value",label:"Status",variant:"outlined",density:"compact"},null,8,["modelValue"])]),_:1}),e(p,{cols:"12",md:"4"},{default:l(()=>[e(I,{modelValue:D.value,"onUpdate:modelValue":t[2]||(t[2]=a=>D.value=a),items:we,"item-title":"label","item-value":"value",label:"Role",variant:"outlined",density:"compact"},null,8,["modelValue"])]),_:1})]),_:1}),e(_,null,{default:l(()=>[e(p,{cols:"12"},{default:l(()=>[o("div",Ie,[e(i,{variant:"outlined",onClick:ke,"prepend-icon":"mdi-refresh"},{default:l(()=>t[22]||(t[22]=[d(" Clear Filters ")])),_:1}),e(ue,{color:"primary",variant:"tonal",class:"ml-auto"},{default:l(()=>[d(f(ce.value.length)+" users found ",1)]),_:1})])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),c(y)?(A(),h(_,{key:0},{default:l(()=>[e(p,{cols:"12"},{default:l(()=>[e(X,null,{default:l(()=>[o("div",Oe,[e(he,{indeterminate:"",color:"primary",size:"64"})])]),_:1})]),_:1})]),_:1})):c(P)?(A(),h(_,{key:1},{default:l(()=>[e(p,{cols:"12"},{default:l(()=>[e(X,null,{default:l(()=>[e(z,{type:"error",variant:"tonal",class:"mb-0"},{default:l(()=>[d(f(c(P)),1)]),_:1})]),_:1})]),_:1})]),_:1})):(A(),h(_,{key:2},{default:l(()=>[e(p,{cols:"12"},{default:l(()=>[e(X,{title:"Users List"},{default:l(()=>[e(Ee,{"fixed-header":"",height:"600px"},{default:l(()=>[t[25]||(t[25]=o("thead",null,[o("tr",null,[o("th",{class:"text-left"},"User"),o("th",{class:"text-left"},"Email"),o("th",{class:"text-left"},"Role"),o("th",{class:"text-left"},"Status"),o("th",{class:"text-left"},"Last Login"),o("th",{class:"text-center"},"Actions")])],-1)),o("tbody",null,[(A(!0),M(fe,null,_e(ce.value,a=>(A(),M("tr",{key:a.id},[o("td",null,[o("div",We,[e(Ue,{size:"40",class:"mr-3"},{default:l(()=>[o("img",{src:a.avatar,alt:a.name},null,8,He)]),_:2},1024),o("div",null,[o("div",Je,f(a.name),1),o("div",Ke,f(a.phone),1)])])]),o("td",null,f(a.email),1),o("td",null,[e(ue,{color:a.role==="Super Admin"?"error":"primary",variant:"tonal",size:"small"},{default:l(()=>[d(f(a.role),1)]),_:2},1032,["color"])]),o("td",null,[e(ue,{color:a.statusColor,variant:"tonal",size:"small"},{default:l(()=>[d(f(a.status),1)]),_:2},1032,["color"])]),o("td",null,f(a.lastLogin),1),o("td",null,[o("div",Qe,[c(n)("admin-update")?(A(),h(i,{key:0,icon:"",size:"small",variant:"text",color:"primary",onClick:q=>xe(a),title:"Edit"},{default:l(()=>[e(j,null,{default:l(()=>t[23]||(t[23]=[d("mdi-pencil")])),_:1})]),_:2},1032,["onClick"])):F("",!0),c(n)("admin-update")?(A(),h(i,{key:1,icon:"",size:"small",variant:"text",color:a.status==="Active"?"warning":"success",onClick:q=>Ve(a),title:a.status==="Active"?"Deactivate":"Activate"},{default:l(()=>[e(j,null,{default:l(()=>[d(f(a.status==="Active"?"mdi-account-off":"mdi-account-check"),1)]),_:2},1024)]),_:2},1032,["color","onClick","title"])):F("",!0),c(n)("admin-delete")?(A(),h(i,{key:2,icon:"",size:"small",variant:"text",color:"error",onClick:q=>be(a),title:"Delete"},{default:l(()=>[e(j,null,{default:l(()=>t[24]||(t[24]=[d("mdi-delete")])),_:1})]),_:2},1032,["onClick"])):F("",!0)])])]))),128))])]),_:1}),c(s)&&c(s).last_page===1?(A(),M("div",Xe,[o("div",Ye," Total: "+f(c(s).total)+" users ",1)])):F("",!0),c(s)&&c(s).last_page>1?(A(),M("div",Ze,[o("div",et," Showing "+f(c(s).from)+" to "+f(c(s).to)+" of "+f(c(s).total)+" users ",1),o("div",tt,[e(I,{"model-value":c(s).per_page,"onUpdate:modelValue":c(le),items:[10,15,25,50],variant:"outlined",density:"compact","hide-details":"",style:{width:"80px"}},null,8,["model-value","onUpdate:modelValue"]),e(i,{icon:"",variant:"text",disabled:!c(ae),onClick:c(ee),title:"Previous page"},{default:l(()=>[e(j,null,{default:l(()=>t[26]||(t[26]=[d("mdi-chevron-left")])),_:1})]),_:1},8,["disabled","onClick"]),o("div",lt,[(A(!0),M(fe,null,_e(c(se),a=>(A(),h(i,{key:a,color:a===c(s).current_page?"primary":void 0,variant:"text",size:"small",onClick:q=>c(te)(a)},{default:l(()=>[d(f(a),1)]),_:2},1032,["color","onClick"]))),128))]),e(i,{icon:"",variant:"text",disabled:!c(G),onClick:c(Z),title:"Next page"},{default:l(()=>[e(j,null,{default:l(()=>t[27]||(t[27]=[d("mdi-chevron-right")])),_:1})]),_:1},8,["disabled","onClick"])])])):F("",!0)]),_:1})]),_:1})]),_:1})),e(Q,{modelValue:E.value,"onUpdate:modelValue":t[10]||(t[10]=a=>E.value=a),"max-width":"600px",scrollable:""},{default:l(()=>[e(K,null,{default:l(()=>[e(O,null,{default:l(()=>t[28]||(t[28]=[d("Create User")])),_:1}),e(W,null,{default:l(()=>[e(pe,null,{default:l(()=>[e(_,null,{default:l(()=>[e(p,{cols:"12"},{default:l(()=>[e(k,{modelValue:m.value.name,"onUpdate:modelValue":t[3]||(t[3]=a=>m.value.name=a),label:"Name",variant:"outlined",required:"",placeholder:"User Name"},null,8,["modelValue"])]),_:1}),e(p,{cols:"12"},{default:l(()=>[e(k,{modelValue:m.value.email,"onUpdate:modelValue":t[4]||(t[4]=a=>m.value.email=a),label:"Email",variant:"outlined",required:"",type:"email",placeholder:"user@example.com"},null,8,["modelValue"])]),_:1}),e(p,{cols:"12"},{default:l(()=>[e(k,{modelValue:m.value.password,"onUpdate:modelValue":t[5]||(t[5]=a=>m.value.password=a),label:"Password",variant:"outlined",required:"",type:"password",placeholder:"Minimum 8 characters"},null,8,["modelValue"])]),_:1}),e(p,{cols:"12"},{default:l(()=>[e(k,{modelValue:m.value.password_confirmation,"onUpdate:modelValue":t[6]||(t[6]=a=>m.value.password_confirmation=a),label:"Confirm Password",variant:"outlined",required:"",type:"password",placeholder:"Re-enter password"},null,8,["modelValue"])]),_:1}),e(p,{cols:"12"},{default:l(()=>[e(I,{modelValue:m.value.role_id,"onUpdate:modelValue":t[7]||(t[7]=a=>m.value.role_id=a),items:c(N),"item-title":"name","item-value":"id",label:"Role (Optional)",variant:"outlined",clearable:"",placeholder:"Select a role"},{item:l(({props:a,item:q})=>[e(Se,Le(ze(a)),{subtitle:l(()=>[o("span",at,f(q.raw.permissionsCount)+" permissions",1)]),_:2},1040)]),_:1},8,["modelValue","items"])]),_:1}),e(p,{cols:"12"},{default:l(()=>[e(ve,{modelValue:m.value.is_active,"onUpdate:modelValue":t[8]||(t[8]=a=>m.value.is_active=a),label:"Active",color:"primary","hide-details":""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),e(J,null,{default:l(()=>[e(H),V.value?(A(),h(z,{key:0,type:"error",variant:"tonal",density:"compact",class:"mr-4"},{default:l(()=>[d(f(V.value),1)]),_:1})):F("",!0),e(i,{onClick:t[9]||(t[9]=a=>E.value=!1),disabled:C.value},{default:l(()=>t[29]||(t[29]=[d("Cancel")])),_:1},8,["disabled"]),e(i,{color:"primary",onClick:me,loading:C.value,disabled:C.value},{default:l(()=>t[30]||(t[30]=[d("Create")])),_:1},8,["loading","disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(Q,{modelValue:$.value,"onUpdate:modelValue":t[15]||(t[15]=a=>$.value=a),"max-width":"600px",scrollable:""},{default:l(()=>[e(K,null,{default:l(()=>[e(O,null,{default:l(()=>{var a;return[d("Edit User: "+f((a=S.value)==null?void 0:a.name),1)]}),_:1}),e(W,null,{default:l(()=>[e(pe,null,{default:l(()=>[e(_,null,{default:l(()=>[e(p,{cols:"12"},{default:l(()=>[e(k,{modelValue:m.value.name,"onUpdate:modelValue":t[11]||(t[11]=a=>m.value.name=a),label:"Name",variant:"outlined",required:""},null,8,["modelValue"])]),_:1}),e(p,{cols:"12"},{default:l(()=>[e(k,{modelValue:m.value.email,"onUpdate:modelValue":t[12]||(t[12]=a=>m.value.email=a),label:"Email",variant:"outlined",required:"",type:"email"},null,8,["modelValue"])]),_:1}),e(p,{cols:"12"},{default:l(()=>[e(ve,{modelValue:m.value.is_active,"onUpdate:modelValue":t[13]||(t[13]=a=>m.value.is_active=a),label:"Active",color:"primary","hide-details":""},null,8,["modelValue"])]),_:1}),e(p,{cols:"12"},{default:l(()=>[e(z,{type:"info",variant:"tonal",density:"compact"},{default:l(()=>t[31]||(t[31]=[o("div",{class:"text-caption"},"Leave password fields empty to keep current password",-1)])),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),e(J,null,{default:l(()=>[e(H),V.value?(A(),h(z,{key:0,type:"error",variant:"tonal",density:"compact",class:"mr-4"},{default:l(()=>[d(f(V.value),1)]),_:1})):F("",!0),e(i,{onClick:t[14]||(t[14]=a=>$.value=!1),disabled:C.value},{default:l(()=>t[32]||(t[32]=[d("Cancel")])),_:1},8,["disabled"]),e(i,{color:"primary",onClick:me,loading:C.value,disabled:C.value},{default:l(()=>t[33]||(t[33]=[d("Save Changes")])),_:1},8,["loading","disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(Q,{modelValue:L.value,"onUpdate:modelValue":t[17]||(t[17]=a=>L.value=a),"max-width":"400px"},{default:l(()=>[e(K,null,{default:l(()=>[e(O,null,{default:l(()=>t[34]||(t[34]=[d("Confirm Deletion")])),_:1}),e(W,null,{default:l(()=>{var a;return[t[35]||(t[35]=o("p",null,"Are you sure you want to delete this user?",-1)),o("p",null,[o("strong",null,f((a=S.value)==null?void 0:a.name),1)]),V.value?(A(),h(z,{key:0,type:"error",variant:"tonal",density:"compact",class:"mt-4"},{default:l(()=>[d(f(V.value),1)]),_:1})):F("",!0)]}),_:1}),e(J,null,{default:l(()=>[e(H),e(i,{onClick:t[16]||(t[16]=a=>L.value=!1),disabled:C.value},{default:l(()=>t[36]||(t[36]=[d("Cancel")])),_:1},8,["disabled"]),e(i,{color:"error",onClick:Ce,loading:C.value,disabled:C.value},{default:l(()=>t[37]||(t[37]=[d("Delete")])),_:1},8,["loading","disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(Q,{modelValue:ie.value,"onUpdate:modelValue":t[19]||(t[19]=a=>ie.value=a),"max-width":"800px"},{default:l(()=>[e(K,null,{default:l(()=>[e(O,null,{default:l(()=>{var a;return[d("Chat with "+f((a=ge.value)==null?void 0:a.name),1)]}),_:1}),e(W,null,{default:l(()=>t[38]||(t[38]=[o("p",null,"Chat interface with the user...",-1)])),_:1}),e(J,null,{default:l(()=>[e(H),e(i,{onClick:t[18]||(t[18]=a=>ie.value=!1)},{default:l(()=>t[39]||(t[39]=[d("Close")])),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])])}}});export{it as default};
