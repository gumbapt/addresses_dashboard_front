import{e as g,l as c,s as u,x as A}from"./AmEn0FOG.js";const C=()=>{const o=g(null),s=g(null),d=g(!1),n=g(null),h=new A,v=async t=>{d.value=!0,n.value=null;try{const e=await h.get(`/reports/${t}`);e.success&&e.data?(o.value=e.data,s.value=null,console.log(`[Report ${t}] Report data structure:`,{hasTechnologyMetrics:!!e.data.raw_data?.technology_metrics,technologyMetrics:e.data.raw_data?.technology_metrics,hasTechnologyDistribution:!!e.data.raw_data?.technology_distribution,technologyDistribution:e.data.raw_data?.technology_distribution,hasSpeedMetrics:!!e.data.raw_data?.speed_metrics,speedMetrics:e.data.raw_data?.speed_metrics,hasGeographic:!!e.data.raw_data?.geographic,geographicStates:e.data.raw_data?.geographic?.states,statesWithSpeed:e.data.raw_data?.geographic?.states?.filter(a=>a.avg_speed>0).length||0,rawDataKeys:e.data.raw_data?Object.keys(e.data.raw_data):[]})):(n.value="Failed to load report data",o.value=null)}catch(e){n.value=e instanceof Error?e.message:"Unexpected error loading report",o.value=null}finally{d.value=!1}},_=async(t,e)=>{d.value=!0,n.value=null;try{const a=new URLSearchParams;e?.period&&a.append("period",e.period),e?.date_from&&a.append("date_from",e.date_from),e?.date_to&&a.append("date_to",e.date_to);const r=a.toString(),l=`/reports/domain/${t}/aggregate${r?`?${r}`:""}`,i=await h.get(l);i.success&&i.data?(s.value=i.data,o.value=null,console.log(`[Domain ${t}] Aggregated data structure:`,{hasTechnologyDistribution:!!i.data.technology_distribution,technologyDistribution:i.data.technology_distribution,providersCount:i.data.providers?.length||0,providersWithTechnology:i.data.providers?.filter(p=>p.technology).length||0,sampleProvider:i.data.providers?.[0],hasGeographic:!!i.data.geographic,hasStates:!!i.data.geographic?.states,statesCount:i.data.geographic?.states?.length||0,statesWithSpeed:i.data.geographic?.states?.filter(p=>p.avg_speed>0).length||0,sampleState:i.data.geographic?.states?.[0],geographicKeys:i.data.geographic?Object.keys(i.data.geographic):[]})):(n.value="Failed to load aggregated data",s.value=null)}catch(a){n.value=a instanceof Error?a.message:"Unexpected error loading aggregated data",s.value=null}finally{d.value=!1}},y=c(()=>{if(s.value?.providers&&Array.isArray(s.value.providers)){const t=s.value.providers.slice(0,8);return{series:t.map(e=>e.total_count),labels:t.map(e=>e.name)}}if(o.value?.raw_data?.providers?.top_providers&&Array.isArray(o.value.raw_data.providers.top_providers)){const t=o.value.raw_data.providers.top_providers.slice(0,8);return{series:t.map(e=>e.total_count),labels:t.map(e=>e.name)}}return{series:[],labels:[]}}),m=c(()=>{if(s.value?.geographic?.states&&Array.isArray(s.value.geographic.states)){const t=s.value.geographic.states.slice(0,10);return{categories:t.map(e=>e.name||e.code),data:t.map(e=>e.total_requests)}}if(o.value?.raw_data?.geographic?.states&&Array.isArray(o.value.raw_data.geographic.states)){const t=[...o.value.raw_data.geographic.states].sort((e,a)=>a.request_count-e.request_count).slice(0,10);return{categories:t.map(e=>e.name||e.code),data:t.map(e=>e.request_count)}}return{categories:[],data:[]}}),f=c(()=>{if(s.value)if(s.value.geographic?.states&&Array.isArray(s.value.geographic.states)){const t=s.value.geographic.states,e=t.filter(a=>a.avg_speed&&a.avg_speed>0).sort((a,r)=>r.avg_speed-a.avg_speed).slice(0,10);if(console.log("[Speed Chart] Aggregated data - States:",{totalStates:t.length,statesWithSpeed:e.length,sampleState:t[0],filteredStates:e.map(a=>({name:a.name||a.code,speed:a.avg_speed}))}),e.length>0)return{categories:e.map(a=>a.name||a.code),data:e.map(a=>a.avg_speed)};console.warn("[Speed Chart] No states with speed > 0 found. All states:",t.map(a=>({name:a.name||a.code,avg_speed:a.avg_speed})))}else console.warn("[Speed Chart] No geographic.states found in aggregated data:",{hasGeographic:!!s.value.geographic,geographicKeys:s.value.geographic?Object.keys(s.value.geographic):[]});if(o.value?.raw_data){const t=o.value.raw_data.speed_metrics;if(t?.by_state&&Array.isArray(t.by_state)){const a=t.by_state.filter(r=>r.avg_speed&&r.avg_speed>0).slice(0,10);if(console.log("[Speed Chart] Using speed_metrics.by_state:",a),a.length>0)return{categories:a.map(r=>r.state||r.name||r.code),data:a.map(r=>r.avg_speed)}}const e=o.value.raw_data.geographic;if(e?.states&&Array.isArray(e.states)){const a=e.states.filter(r=>r.avg_speed&&r.avg_speed>0).sort((r,l)=>(l.avg_speed||0)-(r.avg_speed||0)).slice(0,10);if(console.log("[Speed Chart] Using raw_data.geographic.states:",a),a.length>0)return{categories:a.map(r=>r.name||r.state||r.code),data:a.map(r=>r.avg_speed)}}console.warn("[Speed Chart] No speed data found in report raw_data:",{hasSpeedMetrics:!!t,hasGeographic:!!e,rawDataKeys:Object.keys(o.value.raw_data)})}return console.warn("[Speed Chart] No speed data available"),{categories:[],data:[]}}),w=c(()=>{if(s.value){const t=s.value.technology_distribution;if(t&&Array.isArray(t)&&t.length>0)return console.log("[Technology Chart] Using direct technology_distribution from API:",t),{series:t.map(e=>e.count||e.total_count||0),labels:t.map(e=>e.technology||e.tech||e.name)};if(s.value.providers&&Array.isArray(s.value.providers)){const e=new Map;if(s.value.providers.forEach(a=>{if(a.technology){const r=e.get(a.technology)||0;e.set(a.technology,r+(a.total_count||0))}}),e.size>0){const a=Array.from(e.entries()).sort((r,l)=>l[1]-r[1]);return console.log("[Technology Chart] Calculated from providers:",a),{series:a.map(([r,l])=>l),labels:a.map(([r])=>r)}}}console.warn("[Technology Chart] No technology data found in aggregated data:",s.value)}if(o.value?.raw_data){const t=o.value.raw_data.technology_metrics;if(t?.distribution&&Array.isArray(t.distribution))return console.log("[Technology Chart] Using technology_metrics.distribution:",t.distribution),{series:t.distribution.map(a=>a.count||a.total_count||0),labels:t.distribution.map(a=>a.technology||a.tech||a.name)};const e=o.value.raw_data.technology_distribution;if(e&&Array.isArray(e)&&e.length>0)return console.log("[Technology Chart] Using raw_data.technology_distribution:",e),{series:e.map(a=>a.count||a.total_count||0),labels:e.map(a=>a.technology||a.tech||a.name)};console.warn("[Technology Chart] No technology data found in report raw_data:",o.value.raw_data)}return console.warn("[Technology Chart] No technology data available"),{series:[],labels:[]}}),b=c(()=>{if(s.value?.summary){const t=s.value.summary,e=s.value.period;return{totalRequests:t.total_requests||0,successRate:t.avg_success_rate||0,dailyAverage:e.days_covered>0?t.total_requests/e.days_covered:0,uniqueProviders:t.total_unique_providers||0}}if(o.value?.raw_data?.summary){const t=o.value.raw_data.summary;return{totalRequests:t.total_requests||0,successRate:t.success_rate||0,dailyAverage:t.avg_requests_per_hour*24||0,uniqueProviders:t.unique_providers||0}}return{totalRequests:0,successRate:0,dailyAverage:0,uniqueProviders:0}});return{reportData:u(o),aggregatedData:u(s),loading:u(d),error:u(n),loadDashboardStats:v,loadAggregatedStats:_,providerChartData:y,topStatesChartData:m,speedByStateChartData:f,technologyChartData:w,topCards:b}};export{C as u};
