import{e as S,s as $,x as ne,d as re,u as de,v as ie,f as ue,L as me,l as G,c as L,a as s,w as e,r as d,j as t,t as u,q as o,k as W,h as g,i as D,g as p,F as H,m as J,b as _}from"./Cwk7k6Hy.js";import{_ as A}from"./DxWg7qjb.js";const ce=()=>{const R=S(!1),c=S(null),N=S({}),U=new ne,B=async(y,b,T)=>{R.value=!0,c.value=null,N.value={};try{const x={current_password:y,new_password:b,new_password_confirmation:T},r=await U.post("/change-password",x);return r.success||(c.value=r.message||"Error changing password"),r}catch(x){const r=x instanceof Error?x.message:"Error changing password. Please try again.";return r.includes("401")||r.toLowerCase().includes("incorrect")||r.toLowerCase().includes("unauthorized")?(c.value="Current password is incorrect",N.value.current_password=["Current password is incorrect"],{success:!1,message:"Current password is incorrect"}):r.includes("422")||r.toLowerCase().includes("validation")||r.toLowerCase().includes("invalid")?(c.value=r,{success:!1,message:r}):(c.value=r,{success:!1,message:r})}finally{R.value=!1}},f=()=>{c.value=null,N.value={}};return{loading:$(R),error:$(c),errors:$(N),changePassword:B,clearErrors:f}},pe={class:"pa-6"},_e={class:"d-flex gap-2"},fe={key:0,class:"text-center py-4"},we={class:"mt-1"},ve={class:"text-caption text-medium-emphasis"},ge={class:"d-flex gap-2"},ye={key:0,class:"text-center py-4"},be={class:"d-flex align-center"},xe={class:"text-capitalize"},ke={class:"d-flex flex-wrap gap-1 mt-1"},Pe={class:"text-caption text-medium-emphasis mt-1"},Ne=re({__name:"index",setup(R){const{user:c}=de(),{roles:N,permissions:U,isSuperAdmin:B}=ie(),{loading:f,error:y,errors:b,changePassword:T,clearErrors:x}=ce(),r=ue(),n=me({current_password:"",new_password:"",new_password_confirmation:""});S(!1);const k=S(!1),X=()=>{x();let m=!0;return n.current_password||(m=!1),n.new_password?n.new_password.length<8&&(m=!1):m=!1,n.new_password_confirmation?n.new_password!==n.new_password_confirmation&&(m=!1):m=!1,m},K=async()=>{if(k.value=!1,x(),!X()){r.warning("Please fill in all fields correctly");return}(await T(n.current_password,n.new_password,n.new_password_confirmation)).success?(k.value=!0,r.success("Password changed successfully!"),setTimeout(()=>{j(),k.value=!1},2e3)):y.value?r.error(y.value):r.error("Error changing password. Please check the fields and try again.")},j=()=>{n.current_password="",n.new_password="",n.new_password_confirmation="",x(),k.value=!1},Y=G(()=>{var m;return(m=c.value)!=null&&m.last_login_at?new Date(c.value.last_login_at).toLocaleString("pt-BR",{dateStyle:"medium",timeStyle:"short"}):"Never"}),I=G(()=>{const m={};return U.value.forEach(l=>{const i=l.resource||"Other";m[i]||(m[i]=[]),m[i].push({...l})}),m}),Z=G(()=>Object.keys(I.value).sort());return(m,l)=>{const i=d("v-icon"),P=d("v-list-item-title"),C=d("v-list-item-subtitle"),V=d("v-list-item"),z=d("v-chip"),M=d("v-list"),v=d("v-col"),O=d("v-row"),E=d("v-text-field"),F=d("v-alert"),q=d("v-btn"),Q=d("v-form"),h=d("v-card-title"),ee=d("v-card-text"),se=d("v-card"),le=d("v-expansion-panel-title"),te=d("v-expansion-panel-text"),ae=d("v-expansion-panel"),oe=d("v-expansion-panels");return _(),L("div",pe,[s(O,null,{default:e(()=>[s(v,{cols:"12"},{default:e(()=>[s(A,{title:"My Profile"},{default:e(()=>[s(O,null,{default:e(()=>[s(v,{cols:"12",md:"6"},{default:e(()=>[s(M,{lines:"two",density:"compact"},{default:e(()=>[s(V,null,{prepend:e(()=>[s(i,{color:"primary",class:"mr-4"},{default:e(()=>l[6]||(l[6]=[t("mdi-account")])),_:1})]),default:e(()=>[s(P,null,{default:e(()=>l[7]||(l[7]=[t("Name")])),_:1}),s(C,null,{default:e(()=>{var a;return[t(u(((a=o(c))==null?void 0:a.name)||"N/A"),1)]}),_:1})]),_:1}),s(V,null,{prepend:e(()=>[s(i,{color:"primary",class:"mr-4"},{default:e(()=>l[8]||(l[8]=[t("mdi-email")])),_:1})]),default:e(()=>[s(P,null,{default:e(()=>l[9]||(l[9]=[t("Email")])),_:1}),s(C,null,{default:e(()=>{var a;return[t(u(((a=o(c))==null?void 0:a.email)||"N/A"),1)]}),_:1})]),_:1}),s(V,null,{prepend:e(()=>[s(i,{color:"primary",class:"mr-4"},{default:e(()=>l[10]||(l[10]=[t("mdi-account-check")])),_:1})]),default:e(()=>[s(P,null,{default:e(()=>l[11]||(l[11]=[t("Status")])),_:1}),s(C,null,{default:e(()=>{var a;return[s(z,{color:(a=o(c))!=null&&a.is_active?"success":"error",size:"small"},{default:e(()=>{var w;return[t(u((w=o(c))!=null&&w.is_active?"Active":"Inactive"),1)]}),_:1},8,["color"])]}),_:1})]),_:1})]),_:1})]),_:1}),s(v,{cols:"12",md:"6"},{default:e(()=>[s(M,{lines:"two",density:"compact"},{default:e(()=>[s(V,null,{prepend:e(()=>[s(i,{color:"primary",class:"mr-4"},{default:e(()=>l[12]||(l[12]=[t("mdi-shield-crown")])),_:1})]),default:e(()=>[s(P,null,{default:e(()=>l[13]||(l[13]=[t("Admin Type")])),_:1}),s(C,null,{default:e(()=>[s(z,{color:o(B)?"warning":"info",size:"small"},{default:e(()=>[t(u(o(B)?"Super Admin":"Admin"),1)]),_:1},8,["color"])]),_:1})]),_:1}),s(V,null,{prepend:e(()=>[s(i,{color:"primary",class:"mr-4"},{default:e(()=>l[14]||(l[14]=[t("mdi-clock-outline")])),_:1})]),default:e(()=>[s(P,null,{default:e(()=>l[15]||(l[15]=[t("Last Login")])),_:1}),s(C,null,{default:e(()=>[t(u(Y.value),1)]),_:1})]),_:1}),s(V,null,{prepend:e(()=>[s(i,{color:"primary",class:"mr-4"},{default:e(()=>l[16]||(l[16]=[t("mdi-identifier")])),_:1})]),default:e(()=>[s(P,null,{default:e(()=>l[17]||(l[17]=[t("User ID")])),_:1}),s(C,null,{default:e(()=>{var a;return[t(u(((a=o(c))==null?void 0:a.id)||"N/A"),1)]}),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),s(v,{cols:"12"},{default:e(()=>[s(A,{title:"Change Password",class:"border-primary"},{default:e(()=>[s(O,null,{default:e(()=>[s(v,{cols:"12",md:"8"},{default:e(()=>[s(Q,{onSubmit:W(K,["prevent"])},{default:e(()=>[s(E,{modelValue:n.current_password,"onUpdate:modelValue":l[0]||(l[0]=a=>n.current_password=a),label:"Current Password",type:"password",variant:"outlined",density:"compact","prepend-inner-icon":"mdi-lock","error-messages":o(b).current_password,disabled:o(f),class:"mb-3"},null,8,["modelValue","error-messages","disabled"]),s(E,{modelValue:n.new_password,"onUpdate:modelValue":l[1]||(l[1]=a=>n.new_password=a),label:"New Password",type:"password",variant:"outlined",density:"compact","prepend-inner-icon":"mdi-lock-plus","error-messages":o(b).new_password,disabled:o(f),hint:"Minimum 8 characters","persistent-hint":"",class:"mb-3"},null,8,["modelValue","error-messages","disabled"]),s(E,{modelValue:n.new_password_confirmation,"onUpdate:modelValue":l[2]||(l[2]=a=>n.new_password_confirmation=a),label:"Confirm New Password",type:"password",variant:"outlined",density:"compact","prepend-inner-icon":"mdi-lock-check","error-messages":o(b).new_password_confirmation,disabled:o(f),class:"mb-4"},null,8,["modelValue","error-messages","disabled"]),k.value?(_(),g(F,{key:0,type:"success",variant:"tonal",class:"mb-4"},{default:e(()=>l[18]||(l[18]=[t(" Password changed successfully! ")])),_:1})):D("",!0),o(y)&&!k.value?(_(),g(F,{key:1,type:"error",variant:"tonal",class:"mb-4"},{default:e(()=>[t(u(o(y)),1)]),_:1})):D("",!0),p("div",_e,[s(q,{type:"submit",color:"primary",loading:o(f),disabled:o(f)},{default:e(()=>[s(i,{start:""},{default:e(()=>l[19]||(l[19]=[t("mdi-key")])),_:1}),l[20]||(l[20]=t(" Change Password "))]),_:1},8,["loading","disabled"]),s(q,{variant:"outlined",onClick:j,disabled:o(f)},{default:e(()=>l[21]||(l[21]=[t(" Reset ")])),_:1},8,["disabled"])])]),_:1})]),_:1}),s(v,{cols:"12",md:"4"},{default:e(()=>[s(se,{variant:"tonal",color:"info",class:"pa-4"},{default:e(()=>[s(h,{class:"text-h6 mb-2"},{default:e(()=>[s(i,{class:"mr-2"},{default:e(()=>l[22]||(l[22]=[t("mdi-information")])),_:1}),l[23]||(l[23]=t(" Password Requirements "))]),_:1}),s(ee,null,{default:e(()=>l[24]||(l[24]=[p("ul",{class:"text-body-2"},[p("li",null,"Minimum 8 characters"),p("li",null,"Current password required"),p("li",null,"New password must be confirmed"),p("li",null,"Password change is immediate")],-1)])),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),s(v,{cols:"12",md:"6"},{default:e(()=>[s(A,{title:"Roles"},{default:e(()=>[o(N).length===0?(_(),L("div",fe,[s(i,{size:"48",color:"grey"},{default:e(()=>l[25]||(l[25]=[t("mdi-shield-off")])),_:1}),l[26]||(l[26]=p("p",{class:"text-body-1 text-medium-emphasis mt-2"},"No roles assigned",-1))])):(_(),g(M,{key:1,lines:"two",density:"compact"},{default:e(()=>[(_(!0),L(H,null,J(o(N),a=>(_(),g(V,{key:a.id},{prepend:e(()=>[s(i,{color:"primary",class:"mr-4"},{default:e(()=>l[27]||(l[27]=[t("mdi-shield-account")])),_:1})]),default:e(()=>[s(P,null,{default:e(()=>[t(u(a.name),1)]),_:2},1024),s(C,null,{default:e(()=>[p("div",we,[s(z,{size:"x-small",class:"mr-1 mb-1"},{default:e(()=>{var w;return[t(u(((w=a.permissions)==null?void 0:w.length)||0)+" permissions ",1)]}),_:2},1024),p("span",ve,u(a.description||"No description"),1)])]),_:2},1024)]),_:2},1024))),128))]),_:1}))]),_:1})]),_:1}),s(v,{cols:"12",md:"6"},{default:e(()=>[s(A,{title:"Change Password"},{default:e(()=>[s(Q,{onSubmit:W(K,["prevent"])},{default:e(()=>[s(E,{modelValue:n.current_password,"onUpdate:modelValue":l[3]||(l[3]=a=>n.current_password=a),label:"Current Password",type:"password",variant:"outlined",density:"compact","prepend-inner-icon":"mdi-lock","error-messages":o(b).current_password,disabled:o(f),class:"mb-3"},null,8,["modelValue","error-messages","disabled"]),s(E,{modelValue:n.new_password,"onUpdate:modelValue":l[4]||(l[4]=a=>n.new_password=a),label:"New Password",type:"password",variant:"outlined",density:"compact","prepend-inner-icon":"mdi-lock-plus","error-messages":o(b).new_password,disabled:o(f),hint:"Minimum 8 characters","persistent-hint":"",class:"mb-3"},null,8,["modelValue","error-messages","disabled"]),s(E,{modelValue:n.new_password_confirmation,"onUpdate:modelValue":l[5]||(l[5]=a=>n.new_password_confirmation=a),label:"Confirm New Password",type:"password",variant:"outlined",density:"compact","prepend-inner-icon":"mdi-lock-check","error-messages":o(b).new_password_confirmation,disabled:o(f),class:"mb-4"},null,8,["modelValue","error-messages","disabled"]),k.value?(_(),g(F,{key:0,type:"success",variant:"tonal",class:"mb-4"},{default:e(()=>l[28]||(l[28]=[t(" Password changed successfully! ")])),_:1})):D("",!0),o(y)&&!k.value?(_(),g(F,{key:1,type:"error",variant:"tonal",class:"mb-4"},{default:e(()=>[t(u(o(y)),1)]),_:1})):D("",!0),p("div",ge,[s(q,{type:"submit",color:"primary",loading:o(f),disabled:o(f)},{default:e(()=>[s(i,{start:""},{default:e(()=>l[29]||(l[29]=[t("mdi-key")])),_:1}),l[30]||(l[30]=t(" Change Password "))]),_:1},8,["loading","disabled"]),s(q,{variant:"outlined",onClick:j,disabled:o(f)},{default:e(()=>l[31]||(l[31]=[t(" Reset ")])),_:1},8,["disabled"])])]),_:1})]),_:1})]),_:1}),s(v,{cols:"12"},{default:e(()=>[s(A,{title:"Permissions by Resource"},{default:e(()=>[o(U).length===0?(_(),L("div",ye,[s(i,{size:"48",color:"grey"},{default:e(()=>l[32]||(l[32]=[t("mdi-lock-off")])),_:1}),l[33]||(l[33]=p("p",{class:"text-body-1 text-medium-emphasis mt-2"},"No permissions assigned",-1))])):(_(),g(oe,{key:1,variant:"accordion",class:"mt-2"},{default:e(()=>[(_(!0),L(H,null,J(Z.value,a=>(_(),g(ae,{key:a},{default:e(()=>[s(le,null,{default:e(()=>[p("div",be,[s(i,{color:"primary",class:"mr-2"},{default:e(()=>l[34]||(l[34]=[t("mdi-folder")])),_:1}),p("span",xe,u(a),1),s(z,{size:"x-small",class:"ml-2"},{default:e(()=>[t(u(I.value[a].length),1)]),_:2},1024)])]),_:2},1024),s(te,null,{default:e(()=>[s(M,{density:"compact"},{default:e(()=>[(_(!0),L(H,null,J(I.value[a],w=>(_(),g(V,{key:w.id},{prepend:e(()=>[s(i,{color:w.is_active?"success":"error",size:"small",class:"mr-2"},{default:e(()=>[t(u(w.is_active?"mdi-check-circle":"mdi-close-circle"),1)]),_:2},1032,["color"])]),default:e(()=>[s(P,null,{default:e(()=>[t(u(w.name),1)]),_:2},1024),s(C,null,{default:e(()=>[p("div",ke,[s(z,{size:"x-small",variant:"outlined"},{default:e(()=>[t(u(w.action),1)]),_:2},1024),s(z,{size:"x-small",variant:"outlined"},{default:e(()=>[t(u(w.slug),1)]),_:2},1024)]),p("p",Pe,u(w.description||"No description"),1)]),_:2},1024)]),_:2},1024))),128))]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1}))]),_:1})]),_:1})]),_:1})])}}});export{Ne as default};
