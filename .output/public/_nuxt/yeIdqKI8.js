var P=Object.defineProperty;var E=(n,e,r)=>e in n?P(n,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):n[e]=r;var m=(n,e,r)=>E(n,typeof e!="symbol"?e+"":e,r);import{x as G,e as l,l as i,s as g}from"./BaQHY7cA.js";class x{constructor(){m(this,"apiClient");this.apiClient=new G}async getReports(e){try{const r=new URLSearchParams;e!=null&&e.page&&r.append("page",e.page.toString()),e!=null&&e.per_page&&r.append("per_page",e.per_page.toString()),e!=null&&e.domain_id&&r.append("domain_id",e.domain_id.toString()),e!=null&&e.status&&r.append("status",e.status),e!=null&&e.start_date&&r.append("start_date",e.start_date),e!=null&&e.end_date&&r.append("end_date",e.end_date);const s=r.toString(),c=`/reports${s?"?"+s:""}`;return await this.apiClient.get(c)}catch(r){throw console.error("Get reports failed:",r),new Error("Failed to fetch reports")}}async getReport(e){try{return await this.apiClient.get(`/reports/${e}`)}catch(r){throw console.error("Get report failed:",r),new Error("Failed to fetch report")}}async getRecentReports(){try{return await this.apiClient.get("/reports/recent")}catch(e){throw console.error("Get recent reports failed:",e),new Error("Failed to fetch recent reports")}}async getGlobalDomainRanking(e){try{let r="/reports/global/domain-ranking";return e&&(r+=`?sort_by=${e}`),await this.apiClient.get(r)}catch(r){throw console.error("Get global domain ranking failed:",r),new Error("Failed to fetch global domain ranking")}}async compareDomains(e,r,s,c){try{const o=new URLSearchParams;o.append("domains",e.join(",")),r&&o.append("metric",r),s&&o.append("date_from",s),c&&o.append("date_to",c);const p=`/reports/global/comparison?${o.toString()}`;return await this.apiClient.get(p)}catch(o){throw console.error("Compare domains failed:",o),new Error("Failed to compare domains")}}}class F{constructor(){m(this,"reportRepository");this.reportRepository=new x}async getReports(e){try{const r=await this.reportRepository.getReports(e);return{success:r.success,data:r,message:"Reports loaded successfully"}}catch(r){return{success:!1,error:r instanceof Error?r.message:"Unknown error"}}}async getReport(e){try{const r=await this.reportRepository.getReport(e);return{success:r.success,data:r.data,message:"Report loaded successfully"}}catch(r){return{success:!1,error:r instanceof Error?r.message:"Unknown error"}}}async getRecentReports(){try{const e=await this.reportRepository.getRecentReports();return{success:e.success,data:e.data,message:"Recent reports loaded successfully"}}catch(e){return{success:!1,error:e instanceof Error?e.message:"Unknown error"}}}async getGlobalDomainRanking(e){try{const r=await this.reportRepository.getGlobalDomainRanking(e);return{success:r.success,data:r.data,message:"Global domain ranking loaded successfully"}}catch(r){return{success:!1,error:r instanceof Error?r.message:"Unknown error"}}}async compareDomains(e,r,s,c){try{const o=await this.reportRepository.compareDomains(e,r,s,c);return{success:o.success,data:o.data,message:"Domain comparison loaded successfully"}}catch(o){return{success:!1,error:o instanceof Error?o.message:"Unknown error"}}}}const N=()=>{const n=l([]),e=l(null),r=l(!1),s=l(null),c=new F,o=async a=>{r.value=!0,s.value=null;try{const t=await c.getReports(a);t.success&&t.data?(n.value=t.data.data||[],e.value=t.data.meta||null):(s.value=t.error||"Failed to load reports",n.value=[])}catch{s.value="Unexpected error loading reports",n.value=[]}finally{r.value=!1}},p=async a=>{r.value=!0,s.value=null;try{const t=await c.getReport(a);return t.success&&t.data?t.data:(s.value=t.error||"Failed to load report",null)}catch{return s.value="Unexpected error loading report",null}finally{r.value=!1}},v=async()=>{r.value=!0,s.value=null;try{const a=await c.getRecentReports();a.success&&a.data?n.value=a.data||[]:(s.value=a.error||"Failed to load recent reports",n.value=[])}catch{s.value="Unexpected error loading recent reports",n.value=[]}finally{r.value=!1}},f=a=>{e.value&&e.value.current_page<e.value.last_page&&o({...a,page:e.value.current_page+1,per_page:e.value.per_page})},S=a=>{e.value&&e.value.current_page>1&&o({...a,page:e.value.current_page-1,per_page:e.value.per_page})},b=(a,t)=>{e.value&&a>=1&&a<=e.value.last_page&&o({...t,page:a,per_page:e.value.per_page})},D=(a,t)=>{o({...t,page:1,per_page:a})},y=a=>({pending:"warning",processing:"info",processed:"success",failed:"error"})[a]||"default",h=a=>({pending:"Pending",processing:"Processing",processed:"Processed",failed:"Failed"})[a]||a,R=a=>{var t;return{...a,statusColor:y(a.status),statusLabel:h(a.status),reportDate:new Date(a.report_date).toLocaleDateString("en-US"),createdDate:new Date(a.created_at).toLocaleDateString("en-US"),domainName:((t=a.domain)==null?void 0:t.name)||"N/A"}},M=i(()=>!n.value||!Array.isArray(n.value)?[]:n.value.map(R)),C=i(()=>e.value&&e.value.current_page<e.value.last_page),k=i(()=>e.value&&e.value.current_page>1),U=i(()=>{if(!e.value)return[];const a=[],t=e.value.current_page,u=e.value.last_page;let w=Math.max(1,t-2),_=Math.min(u,t+2);t<=3?_=Math.min(u,5):t>=u-2&&(w=Math.max(1,u-4));for(let d=w;d<=_;d++)a.push(d);return a});return{reports:g(n),meta:g(e),loading:g(r),error:g(s),formattedReports:M,canGoNext:C,canGoPrev:k,pageNumbers:U,loadReports:o,loadReport:p,loadRecentReports:v,nextPage:f,prevPage:S,goToPage:b,changePerPage:D,formatReportForDisplay:R,getStatusColor:y,getStatusLabel:h}};export{F as R,N as u};
