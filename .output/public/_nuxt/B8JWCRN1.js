var T=Object.defineProperty;var b=(c,r,e)=>r in c?T(c,r,{enumerable:!0,configurable:!0,writable:!0,value:e}):c[r]=e;var g=(c,r,e)=>b(c,typeof r!="symbol"?r+"":r,e);import{x as L,e as p,l}from"./B3_Rn74p.js";class M{constructor(){g(this,"apiClient");this.apiClient=new L}async list(r){try{const e=new URLSearchParams;r!=null&&r.page&&e.append("page",r.page.toString()),r!=null&&r.per_page&&e.append("per_page",r.per_page.toString()),r!=null&&r.search&&e.append("search",r.search),(r==null?void 0:r.is_active)!==void 0&&e.append("is_active",r.is_active.toString()),e.append("with_count","true");const o=`/domain-groups${e.toString()?`?${e.toString()}`:""}`;console.log("üîç DomainGroupRepository - list URL:",o);const t=await this.apiClient.get(o);return console.log("üîç DomainGroupRepository - list response:",t),t}catch(e){throw console.error("DomainGroupRepository - list error:",e),e}}async get(r){try{return await this.apiClient.get(`/domain-groups/${r}`)}catch(e){throw console.error("DomainGroupRepository - get error:",e),e}}async create(r){try{return await this.apiClient.post("/domain-groups",r)}catch(e){throw console.error("DomainGroupRepository - create error:",e),e}}async update(r,e){try{return await this.apiClient.put(`/domain-groups/${r}`,e)}catch(o){throw console.error("DomainGroupRepository - update error:",o),o}}async delete(r){try{return await this.apiClient.delete(`/domain-groups/${r}`)}catch(e){throw console.error("DomainGroupRepository - delete error:",e),e}}async getGroupDomains(r){try{console.log("üîç DomainGroupRepository - getGroupDomains called with id:",r);const e=await this.apiClient.get(`/domain-groups/${r}/domains`);return console.log("üîç DomainGroupRepository - getGroupDomains raw response:",e),e}catch(e){throw console.error("DomainGroupRepository - getGroupDomains error:",e),e}}async addDomainsToGroup(r,e){try{return await this.apiClient.post(`/domain-groups/${r}/domains`,{domain_ids:e})}catch(o){throw console.error("DomainGroupRepository - addDomainsToGroup error:",o),o}}async removeDomainsFromGroup(r,e){try{return await this.apiClient.deleteWithBody(`/domain-groups/${r}/domains`,{domain_ids:e})}catch(o){throw console.error("DomainGroupRepository - removeDomainsFromGroup error:",o),o}}}class U{constructor(){g(this,"domainGroupRepository");this.domainGroupRepository=new M}async getDomainGroups(r){try{console.log("üîç DomainGroupService - getDomainGroups called with filters:",r);const e=await this.domainGroupRepository.list(r);return console.log("üîç DomainGroupService - getDomainGroups response:",e),e.data&&e.data.forEach(o=>{console.log(`üîç Group "${o.name}" has domains_count:`,o.domains_count)}),{success:e.success,data:{data:e.data||[],pagination:e.pagination}}}catch(e){return console.error("DomainGroupService - getDomainGroups error:",e),{success:!1,error:e instanceof Error?e.message:"Failed to fetch domain groups"}}}async getDomainGroup(r){try{const e=await this.domainGroupRepository.get(r);return e.success&&e.data?{success:!0,data:e.data}:{success:!1,error:e.message||"Failed to fetch domain group"}}catch(e){return console.error("DomainGroupService - getDomainGroup error:",e),{success:!1,error:e instanceof Error?e.message:"Failed to fetch domain group"}}}async createDomainGroup(r){var e;try{if(!r.name||r.name.trim()==="")return{success:!1,error:"Group name is required"};if(r.max_domains!==null&&r.max_domains!==void 0&&r.max_domains<1)return{success:!1,error:"Max domains must be at least 1 or null for unlimited"};const o=await this.domainGroupRepository.create(r);return o.success&&o.data?{success:!0,data:o.data,message:"Domain group created successfully"}:{success:!1,error:o.message||"Failed to create domain group"}}catch(o){return console.error("DomainGroupService - createDomainGroup error:",o),((e=o==null?void 0:o.response)==null?void 0:e.status)===403?{success:!1,error:"Access denied. Only Super Admins can create domain groups."}:{success:!1,error:o instanceof Error?o.message:"Failed to create domain group"}}}async updateDomainGroup(r,e){var o;try{if(e.max_domains!==null&&e.max_domains!==void 0&&e.max_domains<1)return{success:!1,error:"Max domains must be at least 1 or null for unlimited"};const t=await this.domainGroupRepository.update(r,e);return t.success&&t.data?{success:!0,data:t.data,message:"Domain group updated successfully"}:{success:!1,error:t.message||"Failed to update domain group"}}catch(t){return console.error("DomainGroupService - updateDomainGroup error:",t),((o=t==null?void 0:t.response)==null?void 0:o.status)===403?{success:!1,error:"Access denied. Only Super Admins can update domain groups."}:{success:!1,error:t instanceof Error?t.message:"Failed to update domain group"}}}async deleteDomainGroup(r){var e,o;try{const t=await this.domainGroupRepository.delete(r);return t.success?{success:!0,message:"Domain group deleted successfully"}:{success:!1,error:t.message||"Failed to delete domain group"}}catch(t){return console.error("DomainGroupService - deleteDomainGroup error:",t),((e=t==null?void 0:t.response)==null?void 0:e.status)===400?{success:!1,error:"Cannot delete group with associated domains. Remove domains first."}:((o=t==null?void 0:t.response)==null?void 0:o.status)===403?{success:!1,error:"Access denied. Only Super Admins can delete domain groups."}:{success:!1,error:t instanceof Error?t.message:"Failed to delete domain group"}}}async getGroupDomains(r){var e;try{console.log("üîç DomainGroupService - getGroupDomains called with id:",r);const o=await this.domainGroupRepository.getGroupDomains(r);if(console.log("üîç DomainGroupService - getGroupDomains response:",o),o.success){const t=((e=o.data)==null?void 0:e.domains)||[];return console.log("üîç DomainGroupService - extracted domains:",t),{success:!0,data:t}}return{success:!1,error:o.message||"Failed to fetch group domains"}}catch(o){return console.error("DomainGroupService - getGroupDomains error:",o),{success:!1,error:o instanceof Error?o.message:"Failed to fetch group domains"}}}async addDomainsToGroup(r,e){var o,t;try{if(!e||e.length===0)return{success:!1,error:"Please select at least one domain"};const i=await this.domainGroupRepository.addDomainsToGroup(r,e);return i.success?{success:!0,data:i.data,message:i.message||"Domains added successfully"}:{success:!1,error:i.message||"Failed to add domains to group"}}catch(i){if(console.error("DomainGroupService - addDomainsToGroup error:",i),((o=i==null?void 0:i.response)==null?void 0:o.status)===400){const m=(t=i==null?void 0:i.response)==null?void 0:t.data;return{success:!1,error:(m==null?void 0:m.message)||"Group limit exceeded or validation error"}}return{success:!1,error:i instanceof Error?i.message:"Failed to add domains to group"}}}async removeDomainsFromGroup(r,e){try{if(!e||e.length===0)return{success:!1,error:"Please select at least one domain"};const o=await this.domainGroupRepository.removeDomainsFromGroup(r,e);return o.success?{success:!0,data:o.data,message:o.message||"Domains removed successfully"}:{success:!1,error:o.message||"Failed to remove domains from group"}}catch(o){return console.error("DomainGroupService - removeDomainsFromGroup error:",o),{success:!1,error:o instanceof Error?o.message:"Failed to remove domains from group"}}}}const N=()=>{const c=p([]),r=p(null),e=p(!1),o=p(null),t=new U,i=l(()=>c.value.map(a=>({...a,statusLabel:a.is_active?"Active":"Inactive",statusColor:a.is_active?"success":"error",domainsCount:a.domains_count||0,limitLabel:a.max_domains?`${a.domains_count||0}/${a.max_domains}`:"Unlimited",availableSlots:a.max_domains?a.max_domains-(a.domains_count||0):null,isFull:a.has_reached_limit||!1,createdDate:new Date(a.created_at).toLocaleDateString("en-US"),updatedDate:new Date(a.updated_at).toLocaleDateString("en-US")}))),m=l(()=>i.value.filter(a=>a.is_active)),D=l(()=>i.value.filter(a=>a.is_active&&!a.isFull)),u=async a=>{e.value=!0,o.value=null;try{const s=await t.getDomainGroups(a);s.success&&s.data?(c.value=s.data.data,r.value=s.data.pagination):o.value=s.error||"Failed to load domain groups"}catch(s){o.value=s instanceof Error?s.message:"Failed to load domain groups",console.error("Load domain groups error:",s)}finally{e.value=!1}},y=async a=>{try{return await t.getDomainGroup(a)}catch(s){return console.error("Get domain group error:",s),{success:!1,error:s instanceof Error?s.message:"Failed to fetch domain group"}}},h=async a=>{try{const s=await t.createDomainGroup(a);return s.success&&await u(),s}catch(s){return console.error("Create domain group error:",s),{success:!1,error:s instanceof Error?s.message:"Failed to create domain group"}}},v=async(a,s)=>{try{const n=await t.updateDomainGroup(a,s);return n.success&&await u(),n}catch(n){return console.error("Update domain group error:",n),{success:!1,error:n instanceof Error?n.message:"Failed to update domain group"}}},w=async a=>{try{const s=await t.deleteDomainGroup(a);return s.success&&await u(),s}catch(s){return console.error("Delete domain group error:",s),{success:!1,error:s instanceof Error?s.message:"Failed to delete domain group"}}},_=async a=>{try{return await t.getGroupDomains(a)}catch(s){return console.error("Get group domains error:",s),{success:!1,error:s instanceof Error?s.message:"Failed to fetch group domains"}}},F=async(a,s)=>{try{const n=await t.addDomainsToGroup(a,s);return n.success&&await u(),n}catch(n){return console.error("Add domains to group error:",n),{success:!1,error:n instanceof Error?n.message:"Failed to add domains to group"}}},S=async(a,s)=>{try{const n=await t.removeDomainsFromGroup(a,s);return n.success&&await u(),n}catch(n){return console.error("Remove domains from group error:",n),{success:!1,error:n instanceof Error?n.message:"Failed to remove domains from group"}}},R=a=>{r.value&&r.value.current_page<r.value.last_page&&u({...a,page:r.value.current_page+1})},x=a=>{r.value&&r.value.current_page>1&&u({...a,page:r.value.current_page-1})},E=(a,s)=>{u({...s,page:a})},C=(a,s)=>{u({...s,per_page:a,page:1})},$=l(()=>r.value&&r.value.current_page<r.value.last_page),P=l(()=>r.value&&r.value.current_page>1),A=l(()=>{if(!r.value)return[];const a=[],s=r.value.current_page,n=r.value.last_page;let f=Math.max(1,s-2),G=Math.min(n,s+2);s<=2&&(G=Math.min(5,n)),s>=n-1&&(f=Math.max(1,n-4));for(let d=f;d<=G;d++)a.push(d);return a});return{domainGroups:c,formattedGroups:i,activeGroups:m,availableGroups:D,pagination:r,loading:e,error:o,loadDomainGroups:u,getDomainGroup:y,createDomainGroup:h,updateDomainGroup:v,deleteDomainGroup:w,getGroupDomains:_,addDomainsToGroup:F,removeDomainsFromGroup:S,nextPage:R,prevPage:x,goToPage:E,changePerPage:C,canGoNext:$,canGoPrev:P,pageNumbers:A}};export{N as u};
