import{x as A,e as l,l as c}from"./AmEn0FOG.js";class T{apiClient;constructor(){this.apiClient=new A}async list(r){try{const e=new URLSearchParams;r?.page&&e.append("page",r.page.toString()),r?.per_page&&e.append("per_page",r.per_page.toString()),r?.search&&e.append("search",r.search),r?.is_active!==void 0&&e.append("is_active",r.is_active.toString()),e.append("with_count","true");const o=`/domain-groups${e.toString()?`?${e.toString()}`:""}`;console.log("üîç DomainGroupRepository - list URL:",o);const n=await this.apiClient.get(o);return console.log("üîç DomainGroupRepository - list response:",n),n}catch(e){throw console.error("DomainGroupRepository - list error:",e),e}}async get(r){try{return await this.apiClient.get(`/domain-groups/${r}`)}catch(e){throw console.error("DomainGroupRepository - get error:",e),e}}async create(r){try{return await this.apiClient.post("/domain-groups",r)}catch(e){throw console.error("DomainGroupRepository - create error:",e),e}}async update(r,e){try{return await this.apiClient.put(`/domain-groups/${r}`,e)}catch(o){throw console.error("DomainGroupRepository - update error:",o),o}}async delete(r){try{return await this.apiClient.delete(`/domain-groups/${r}`)}catch(e){throw console.error("DomainGroupRepository - delete error:",e),e}}async getGroupDomains(r){try{console.log("üîç DomainGroupRepository - getGroupDomains called with id:",r);const e=await this.apiClient.get(`/domain-groups/${r}/domains`);return console.log("üîç DomainGroupRepository - getGroupDomains raw response:",e),e}catch(e){throw console.error("DomainGroupRepository - getGroupDomains error:",e),e}}async addDomainsToGroup(r,e){try{return await this.apiClient.post(`/domain-groups/${r}/domains`,{domain_ids:e})}catch(o){throw console.error("DomainGroupRepository - addDomainsToGroup error:",o),o}}async removeDomainsFromGroup(r,e){try{return await this.apiClient.deleteWithBody(`/domain-groups/${r}/domains`,{domain_ids:e})}catch(o){throw console.error("DomainGroupRepository - removeDomainsFromGroup error:",o),o}}}class b{domainGroupRepository;constructor(){this.domainGroupRepository=new T}async getDomainGroups(r){try{console.log("üîç DomainGroupService - getDomainGroups called with filters:",r);const e=await this.domainGroupRepository.list(r);return console.log("üîç DomainGroupService - getDomainGroups response:",e),e.data&&e.data.forEach(o=>{console.log(`üîç Group "${o.name}" has domains_count:`,o.domains_count)}),{success:e.success,data:{data:e.data||[],pagination:e.pagination}}}catch(e){return console.error("DomainGroupService - getDomainGroups error:",e),{success:!1,error:e instanceof Error?e.message:"Failed to fetch domain groups"}}}async getDomainGroup(r){try{const e=await this.domainGroupRepository.get(r);return e.success&&e.data?{success:!0,data:e.data}:{success:!1,error:e.message||"Failed to fetch domain group"}}catch(e){return console.error("DomainGroupService - getDomainGroup error:",e),{success:!1,error:e instanceof Error?e.message:"Failed to fetch domain group"}}}async createDomainGroup(r){try{if(!r.name||r.name.trim()==="")return{success:!1,error:"Group name is required"};if(r.max_domains!==null&&r.max_domains!==void 0&&r.max_domains<1)return{success:!1,error:"Max domains must be at least 1 or null for unlimited"};const e=await this.domainGroupRepository.create(r);return e.success&&e.data?{success:!0,data:e.data,message:"Domain group created successfully"}:{success:!1,error:e.message||"Failed to create domain group"}}catch(e){return console.error("DomainGroupService - createDomainGroup error:",e),e?.response?.status===403?{success:!1,error:"Access denied. Only Super Admins can create domain groups."}:{success:!1,error:e instanceof Error?e.message:"Failed to create domain group"}}}async updateDomainGroup(r,e){try{if(e.max_domains!==null&&e.max_domains!==void 0&&e.max_domains<1)return{success:!1,error:"Max domains must be at least 1 or null for unlimited"};const o=await this.domainGroupRepository.update(r,e);return o.success&&o.data?{success:!0,data:o.data,message:"Domain group updated successfully"}:{success:!1,error:o.message||"Failed to update domain group"}}catch(o){return console.error("DomainGroupService - updateDomainGroup error:",o),o?.response?.status===403?{success:!1,error:"Access denied. Only Super Admins can update domain groups."}:{success:!1,error:o instanceof Error?o.message:"Failed to update domain group"}}}async deleteDomainGroup(r){try{const e=await this.domainGroupRepository.delete(r);return e.success?{success:!0,message:"Domain group deleted successfully"}:{success:!1,error:e.message||"Failed to delete domain group"}}catch(e){return console.error("DomainGroupService - deleteDomainGroup error:",e),e?.response?.status===400?{success:!1,error:"Cannot delete group with associated domains. Remove domains first."}:e?.response?.status===403?{success:!1,error:"Access denied. Only Super Admins can delete domain groups."}:{success:!1,error:e instanceof Error?e.message:"Failed to delete domain group"}}}async getGroupDomains(r){try{console.log("üîç DomainGroupService - getGroupDomains called with id:",r);const e=await this.domainGroupRepository.getGroupDomains(r);if(console.log("üîç DomainGroupService - getGroupDomains response:",e),e.success){const o=e.data?.domains||[];return console.log("üîç DomainGroupService - extracted domains:",o),{success:!0,data:o}}return{success:!1,error:e.message||"Failed to fetch group domains"}}catch(e){return console.error("DomainGroupService - getGroupDomains error:",e),{success:!1,error:e instanceof Error?e.message:"Failed to fetch group domains"}}}async addDomainsToGroup(r,e){try{if(!e||e.length===0)return{success:!1,error:"Please select at least one domain"};const o=await this.domainGroupRepository.addDomainsToGroup(r,e);return o.success?{success:!0,data:o.data,message:o.message||"Domains added successfully"}:{success:!1,error:o.message||"Failed to add domains to group"}}catch(o){return console.error("DomainGroupService - addDomainsToGroup error:",o),o?.response?.status===400?{success:!1,error:o?.response?.data?.message||"Group limit exceeded or validation error"}:{success:!1,error:o instanceof Error?o.message:"Failed to add domains to group"}}}async removeDomainsFromGroup(r,e){try{if(!e||e.length===0)return{success:!1,error:"Please select at least one domain"};const o=await this.domainGroupRepository.removeDomainsFromGroup(r,e);return o.success?{success:!0,data:o.data,message:o.message||"Domains removed successfully"}:{success:!1,error:o.message||"Failed to remove domains from group"}}catch(o){return console.error("DomainGroupService - removeDomainsFromGroup error:",o),{success:!1,error:o instanceof Error?o.message:"Failed to remove domains from group"}}}}const M=()=>{const u=l([]),r=l(null),e=l(!1),o=l(null),n=new b,m=c(()=>u.value.map(a=>({...a,statusLabel:a.is_active?"Active":"Inactive",statusColor:a.is_active?"success":"error",domainsCount:a.domains_count||0,limitLabel:a.max_domains?`${a.domains_count||0}/${a.max_domains}`:"Unlimited",availableSlots:a.max_domains?a.max_domains-(a.domains_count||0):null,isFull:a.has_reached_limit||!1,createdDate:new Date(a.created_at).toLocaleDateString("en-US"),updatedDate:new Date(a.updated_at).toLocaleDateString("en-US")}))),f=c(()=>m.value.filter(a=>a.is_active)),G=c(()=>m.value.filter(a=>a.is_active&&!a.isFull)),i=async a=>{e.value=!0,o.value=null;try{const s=await n.getDomainGroups(a);s.success&&s.data?(u.value=s.data.data,r.value=s.data.pagination):o.value=s.error||"Failed to load domain groups"}catch(s){o.value=s instanceof Error?s.message:"Failed to load domain groups",console.error("Load domain groups error:",s)}finally{e.value=!1}},D=async a=>{try{return await n.getDomainGroup(a)}catch(s){return console.error("Get domain group error:",s),{success:!1,error:s instanceof Error?s.message:"Failed to fetch domain group"}}},y=async a=>{try{const s=await n.createDomainGroup(a);return s.success&&await i(),s}catch(s){return console.error("Create domain group error:",s),{success:!1,error:s instanceof Error?s.message:"Failed to create domain group"}}},h=async(a,s)=>{try{const t=await n.updateDomainGroup(a,s);return t.success&&await i(),t}catch(t){return console.error("Update domain group error:",t),{success:!1,error:t instanceof Error?t.message:"Failed to update domain group"}}},v=async a=>{try{const s=await n.deleteDomainGroup(a);return s.success&&await i(),s}catch(s){return console.error("Delete domain group error:",s),{success:!1,error:s instanceof Error?s.message:"Failed to delete domain group"}}},w=async a=>{try{return await n.getGroupDomains(a)}catch(s){return console.error("Get group domains error:",s),{success:!1,error:s instanceof Error?s.message:"Failed to fetch group domains"}}},_=async(a,s)=>{try{const t=await n.addDomainsToGroup(a,s);return t.success&&await i(),t}catch(t){return console.error("Add domains to group error:",t),{success:!1,error:t instanceof Error?t.message:"Failed to add domains to group"}}},F=async(a,s)=>{try{const t=await n.removeDomainsFromGroup(a,s);return t.success&&await i(),t}catch(t){return console.error("Remove domains from group error:",t),{success:!1,error:t instanceof Error?t.message:"Failed to remove domains from group"}}},S=a=>{r.value&&r.value.current_page<r.value.last_page&&i({...a,page:r.value.current_page+1})},R=a=>{r.value&&r.value.current_page>1&&i({...a,page:r.value.current_page-1})},x=(a,s)=>{i({...s,page:a})},E=(a,s)=>{i({...s,per_page:a,page:1})},C=c(()=>r.value&&r.value.current_page<r.value.last_page),$=c(()=>r.value&&r.value.current_page>1),P=c(()=>{if(!r.value)return[];const a=[],s=r.value.current_page,t=r.value.last_page;let d=Math.max(1,s-2),g=Math.min(t,s+2);s<=2&&(g=Math.min(5,t)),s>=t-1&&(d=Math.max(1,t-4));for(let p=d;p<=g;p++)a.push(p);return a});return{domainGroups:u,formattedGroups:m,activeGroups:f,availableGroups:G,pagination:r,loading:e,error:o,loadDomainGroups:i,getDomainGroup:D,createDomainGroup:y,updateDomainGroup:h,deleteDomainGroup:v,getGroupDomains:w,addDomainsToGroup:_,removeDomainsFromGroup:F,nextPage:S,prevPage:R,goToPage:x,changePerPage:E,canGoNext:C,canGoPrev:$,pageNumbers:P}};export{M as u};
