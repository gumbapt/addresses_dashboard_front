import{e as f,l as m,s as w,x as P}from"./BaQHY7cA.js";const W=()=>{const i=f(null),o=f(null),h=f(!1),g=f(null),b=new P,A=async n=>{var s,t,a,e,r,d,u,v,_,y,l,p;h.value=!0,g.value=null;try{const c=await b.get(`/reports/${n}`);c.success&&c.data?(i.value=c.data,o.value=null,console.log(`[Report ${n}] Report data structure:`,{hasTechnologyMetrics:!!((s=c.data.raw_data)!=null&&s.technology_metrics),technologyMetrics:(t=c.data.raw_data)==null?void 0:t.technology_metrics,hasTechnologyDistribution:!!((a=c.data.raw_data)!=null&&a.technology_distribution),technologyDistribution:(e=c.data.raw_data)==null?void 0:e.technology_distribution,hasSpeedMetrics:!!((r=c.data.raw_data)!=null&&r.speed_metrics),speedMetrics:(d=c.data.raw_data)==null?void 0:d.speed_metrics,hasGeographic:!!((u=c.data.raw_data)!=null&&u.geographic),geographicStates:(_=(v=c.data.raw_data)==null?void 0:v.geographic)==null?void 0:_.states,statesWithSpeed:((p=(l=(y=c.data.raw_data)==null?void 0:y.geographic)==null?void 0:l.states)==null?void 0:p.filter(N=>N.avg_speed>0).length)||0,rawDataKeys:c.data.raw_data?Object.keys(c.data.raw_data):[]})):(g.value="Failed to load report data",i.value=null)}catch(c){g.value=c instanceof Error?c.message:"Unexpected error loading report",i.value=null}finally{h.value=!1}},S=async n=>{var s,t,a,e,r,d,u,v,_,y;h.value=!0,g.value=null;try{const l=await b.get(`/reports/domain/${n}/aggregate`);l.success&&l.data?(o.value=l.data,i.value=null,console.log(`[Domain ${n}] Aggregated data structure:`,{hasTechnologyDistribution:!!l.data.technology_distribution,technologyDistribution:l.data.technology_distribution,providersCount:((s=l.data.providers)==null?void 0:s.length)||0,providersWithTechnology:((t=l.data.providers)==null?void 0:t.filter(p=>p.technology).length)||0,sampleProvider:(a=l.data.providers)==null?void 0:a[0],hasGeographic:!!l.data.geographic,hasStates:!!((e=l.data.geographic)!=null&&e.states),statesCount:((d=(r=l.data.geographic)==null?void 0:r.states)==null?void 0:d.length)||0,statesWithSpeed:((v=(u=l.data.geographic)==null?void 0:u.states)==null?void 0:v.filter(p=>p.avg_speed>0).length)||0,sampleState:(y=(_=l.data.geographic)==null?void 0:_.states)==null?void 0:y[0],geographicKeys:l.data.geographic?Object.keys(l.data.geographic):[]})):(g.value="Failed to load aggregated data",o.value=null)}catch(l){g.value=l instanceof Error?l.message:"Unexpected error loading aggregated data",o.value=null}finally{h.value=!1}},C=m(()=>{var n,s,t,a;if((n=o.value)!=null&&n.providers&&Array.isArray(o.value.providers)){const e=o.value.providers.slice(0,8);return{series:e.map(r=>r.total_count),labels:e.map(r=>r.name)}}if((a=(t=(s=i.value)==null?void 0:s.raw_data)==null?void 0:t.providers)!=null&&a.top_providers&&Array.isArray(i.value.raw_data.providers.top_providers)){const e=i.value.raw_data.providers.top_providers.slice(0,8);return{series:e.map(r=>r.total_count),labels:e.map(r=>r.name)}}return{series:[],labels:[]}}),D=m(()=>{var n,s,t,a,e;if((s=(n=o.value)==null?void 0:n.geographic)!=null&&s.states&&Array.isArray(o.value.geographic.states)){const r=o.value.geographic.states.slice(0,10);return{categories:r.map(d=>d.name||d.code),data:r.map(d=>d.total_requests)}}if((e=(a=(t=i.value)==null?void 0:t.raw_data)==null?void 0:a.geographic)!=null&&e.states&&Array.isArray(i.value.raw_data.geographic.states)){const r=[...i.value.raw_data.geographic.states].sort((d,u)=>u.request_count-d.request_count).slice(0,10);return{categories:r.map(d=>d.name||d.code),data:r.map(d=>d.request_count)}}return{categories:[],data:[]}}),q=m(()=>{var n,s;if(o.value)if((n=o.value.geographic)!=null&&n.states&&Array.isArray(o.value.geographic.states)){const t=o.value.geographic.states,a=t.filter(e=>e.avg_speed&&e.avg_speed>0).sort((e,r)=>r.avg_speed-e.avg_speed).slice(0,10);if(console.log("[Speed Chart] Aggregated data - States:",{totalStates:t.length,statesWithSpeed:a.length,sampleState:t[0],filteredStates:a.map(e=>({name:e.name||e.code,speed:e.avg_speed}))}),a.length>0)return{categories:a.map(e=>e.name||e.code),data:a.map(e=>e.avg_speed)};console.warn("[Speed Chart] No states with speed > 0 found. All states:",t.map(e=>({name:e.name||e.code,avg_speed:e.avg_speed})))}else console.warn("[Speed Chart] No geographic.states found in aggregated data:",{hasGeographic:!!o.value.geographic,geographicKeys:o.value.geographic?Object.keys(o.value.geographic):[]});if((s=i.value)!=null&&s.raw_data){const t=i.value.raw_data.speed_metrics;if(t!=null&&t.by_state&&Array.isArray(t.by_state)){const e=t.by_state.filter(r=>r.avg_speed&&r.avg_speed>0).slice(0,10);if(console.log("[Speed Chart] Using speed_metrics.by_state:",e),e.length>0)return{categories:e.map(r=>r.state||r.name||r.code),data:e.map(r=>r.avg_speed)}}const a=i.value.raw_data.geographic;if(a!=null&&a.states&&Array.isArray(a.states)){const e=a.states.filter(r=>r.avg_speed&&r.avg_speed>0).sort((r,d)=>(d.avg_speed||0)-(r.avg_speed||0)).slice(0,10);if(console.log("[Speed Chart] Using raw_data.geographic.states:",e),e.length>0)return{categories:e.map(r=>r.name||r.state||r.code),data:e.map(r=>r.avg_speed)}}console.warn("[Speed Chart] No speed data found in report raw_data:",{hasSpeedMetrics:!!t,hasGeographic:!!a,rawDataKeys:Object.keys(i.value.raw_data)})}return console.warn("[Speed Chart] No speed data available"),{categories:[],data:[]}}),T=m(()=>{var n;if(o.value){const s=o.value.technology_distribution;if(s&&Array.isArray(s)&&s.length>0)return console.log("[Technology Chart] Using direct technology_distribution from API:",s),{series:s.map(t=>t.count||t.total_count||0),labels:s.map(t=>t.technology||t.tech||t.name)};if(o.value.providers&&Array.isArray(o.value.providers)){const t=new Map;if(o.value.providers.forEach(a=>{if(a.technology){const e=t.get(a.technology)||0;t.set(a.technology,e+(a.total_count||0))}}),t.size>0){const a=Array.from(t.entries()).sort((e,r)=>r[1]-e[1]);return console.log("[Technology Chart] Calculated from providers:",a),{series:a.map(([e,r])=>r),labels:a.map(([e])=>e)}}}console.warn("[Technology Chart] No technology data found in aggregated data:",o.value)}if((n=i.value)!=null&&n.raw_data){const s=i.value.raw_data.technology_metrics;if(s!=null&&s.distribution&&Array.isArray(s.distribution))return console.log("[Technology Chart] Using technology_metrics.distribution:",s.distribution),{series:s.distribution.map(a=>a.count||a.total_count||0),labels:s.distribution.map(a=>a.technology||a.tech||a.name)};const t=i.value.raw_data.technology_distribution;if(t&&Array.isArray(t)&&t.length>0)return console.log("[Technology Chart] Using raw_data.technology_distribution:",t),{series:t.map(a=>a.count||a.total_count||0),labels:t.map(a=>a.technology||a.tech||a.name)};console.warn("[Technology Chart] No technology data found in report raw_data:",i.value.raw_data)}return console.warn("[Technology Chart] No technology data available"),{series:[],labels:[]}}),R=m(()=>{var n,s,t;if((n=o.value)!=null&&n.summary){const a=o.value.summary,e=o.value.period;return{totalRequests:a.total_requests||0,successRate:a.avg_success_rate||0,dailyAverage:e.days_covered>0?a.total_requests/e.days_covered:0,uniqueProviders:a.total_unique_providers||0}}if((t=(s=i.value)==null?void 0:s.raw_data)!=null&&t.summary){const a=i.value.raw_data.summary;return{totalRequests:a.total_requests||0,successRate:a.success_rate||0,dailyAverage:a.avg_requests_per_hour*24||0,uniqueProviders:a.unique_providers||0}}return{totalRequests:0,successRate:0,dailyAverage:0,uniqueProviders:0}});return{reportData:w(i),aggregatedData:w(o),loading:w(h),error:w(g),loadDashboardStats:A,loadAggregatedStats:S,providerChartData:C,topStatesChartData:D,speedByStateChartData:q,technologyChartData:T,topCards:R}};export{W as u};
