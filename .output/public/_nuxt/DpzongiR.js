var $e=Object.defineProperty;var Te=(v,e,o)=>e in v?$e(v,e,{enumerable:!0,configurable:!0,writable:!0,value:o}):v[e]=o;var ce=(v,e,o)=>Te(v,typeof e!="symbol"?e+"":e,o);import{x as xe,u as ve,e as A,y as De,l as H,o as Ce,z as Se,s as B,B as de,d as Ae,C as _e,c as S,g as l,h as Z,i as ae,a,q as g,r as E,w as s,j as m,t as _,F as pe,m as me,k as Re,D as Ie,E as ue,b as y,G as be,_ as Pe,A as Ne}from"./B3_Rn74p.js";import{_ as he}from"./CCmYOoiB.js";class Ve{constructor(e){ce(this,"apiClient");ce(this,"chatApiClient");this.apiClient=new xe;const o=e||"https://dash3.50g.io/api";this.chatApiClient=new xe(o)}async sendMessageToUser(e,o,r){try{return await this.chatApiClient.post("/chat/send",{content:e,receiver_type:r,receiver_id:o,message_type:"text"})}catch(n){throw console.error("ChatRepository - sendMessageToUser error:",n),new Error("Failed to send message")}}async getConversation(e,o,r=1,n=50){try{const p=await this.chatApiClient.get(`/chat/conversation?other_user_type=${o}&other_user_id=${e}&page=${r}&per_page=${n}`);return console.log("ðŸ” ChatRepository - getConversation raw response:",p),p}catch(p){throw console.error("ChatRepository - getConversation error:",p),new Error("Failed to fetch conversation")}}async getChats(e=1,o=20){try{const r=await this.chatApiClient.get(`/chats?page=${e}&per_page=${o}`);return console.log("ðŸ” ChatRepository - getChats raw response:",r),r}catch(r){throw console.error("ChatRepository - getChats error:",r),new Error("Failed to fetch chats")}}async getChatMessages(e,o=1,r=50){try{const n=await this.chatApiClient.get(`/chat/${e}/messages?page=${o}&per_page=${r}`);return console.log("ðŸ” ChatRepository - getChatMessages raw response:",n),n}catch(n){throw console.error("ChatRepository - getChatMessages error:",n),new Error("Failed to fetch chat messages")}}async sendMessageToChat(e,o){try{return await this.chatApiClient.post(`/chat/${e}/send`,{content:o,message_type:"text"})}catch(r){throw console.error("ChatRepository - sendMessageToChat error:",r),new Error("Failed to send message")}}async createPrivateChat(e,o){try{return await this.chatApiClient.post("/chat/create-private",{other_user_id:e,other_user_type:o})}catch(r){throw console.error("ChatRepository - createPrivateChat error:",r),new Error("Failed to create private chat")}}async createGroupChat(e,o,r){try{return await this.chatApiClient.post("/chat/create-group",{name:e,description:o,participants:r})}catch(n){throw console.error("ChatRepository - createGroupChat error:",n),new Error("Failed to create group chat")}}async getChannels(){try{return await this.chatApiClient.get("/chat/channels")}catch{throw new Error("Failed to fetch chat channels")}}async markAsRead(e){try{await this.chatApiClient.post(`/chat/channels/${e}/read`)}catch{throw new Error("Failed to mark messages as read")}}async getOnlineUsers(){try{return await this.chatApiClient.get("/chat/users/online")}catch{throw new Error("Failed to fetch online users")}}}class Le{constructor(e){ce(this,"chatRepository");this.chatRepository=new Ve(e)}async createPrivateChat(e,o){try{const r=await this.chatRepository.createPrivateChat(e,o);if(console.log("ðŸ” ChatService - createPrivateChat response:",r),r.success&&r.data)return r.data;throw new Error("Invalid API response when creating chat")}catch(r){throw console.error("ChatService - createPrivateChat error:",r),r}}async createGroupChat(e,o,r){try{const n=await this.chatRepository.createGroupChat(e,o,r);if(n.success&&n.data)return n.data;throw new Error("Invalid API response when creating group chat")}catch(n){throw console.error("ChatService - createGroupChat error:",n),n}}async sendMessageToUser(e,o,r){try{if(!e.trim())throw new Error("Message cannot be empty");if(e.length>1e3)throw new Error("Message too long (maximum 1000 characters)");const n=await this.chatRepository.sendMessageToUser(e.trim(),o,r);if(n.success&&n.data)return n.data;throw new Error("Invalid API response when sending message to user")}catch(n){throw console.error("ChatService - sendMessageToUser error:",n),n}}async sendMessageToChat(e,o){try{if(!o.trim())throw new Error("Message cannot be empty");if(o.length>1e3)throw new Error("Message too long (maximum 1000 characters)");const r=await this.chatRepository.sendMessageToChat(e,o.trim());if(r.success&&r.data)return r.data;throw new Error("Invalid API response when sending message to chat")}catch(r){throw console.error("ChatService - sendMessageToChat error:",r),r}}async getConversation(e,o,r=1,n=50){try{const p=await this.chatRepository.getConversation(e,o,r,n);if(console.log("ðŸ” ChatService - getConversation response:",p),console.log("ðŸ” ChatService - response type:",typeof p),console.log("ðŸ” ChatService - response keys:",Object.keys(p||{})),p&&typeof p=="object"&&"success"in p&&"data"in p){const P=p;if(P.success&&P.data)return P.data;throw new Error("Invalid API response when fetching conversation")}if(p&&typeof p=="object"&&"messages"in p&&"pagination"in p)return p;throw new Error("Unexpected API response format")}catch(p){throw console.error("ChatService - getConversation error:",p),p}}async getChats(e=1,o=20){try{const r=await this.chatRepository.getChats(e,o);if(console.log("ðŸ” ChatService - getChats response:",r),console.log("ðŸ” ChatService - response type:",typeof r),console.log("ðŸ” ChatService - response keys:",Object.keys(r||{})),r&&typeof r=="object"&&"success"in r&&"data"in r){const n=r;if(n.success&&n.data)return n.data;throw new Error("Invalid API response when fetching chats")}if(r&&typeof r=="object"&&"chats"in r&&"pagination"in r)return r;throw new Error("Unexpected API response format")}catch(r){throw console.error("ChatService - getChats error:",r),r}}async getChatMessages(e,o=1,r=50){try{const n=await this.chatRepository.getChatMessages(e,o,r);if(console.log("ðŸ” ChatService - getChatMessages response:",n),console.log("ðŸ” ChatService - response type:",typeof n),console.log("ðŸ” ChatService - response keys:",Object.keys(n||{})),n&&typeof n=="object"&&"success"in n&&"data"in n){const p=n;if(p.success&&p.data)return p.data;throw new Error("Invalid API response when fetching chat messages")}if(n&&typeof n=="object"&&"messages"in n&&"pagination"in n)return n;throw new Error("Unexpected API response format")}catch(n){throw console.error("ChatService - getChatMessages error:",n),n}}formatMessage(e){const o=ve().user.value;let r="--:--";try{if(e.created_at){const n=new Date(e.created_at);isNaN(n.getTime())||(r=n.toLocaleTimeString("pt-BR",{hour:"2-digit",minute:"2-digit"}))}}catch(n){console.warn("Error formatting message date:",n,e)}return{...e,time:r,isOwn:e.sender_id===(o==null?void 0:o.id),user_name:e.sender_type==="admin"?"Admin":"User"}}validateChat(e){return!!(e.id&&e.type&&["private","group"].includes(e.type))}getChatDisplayName(e){if(!e.name)return e.type==="private"?"Private Chat":"Group Chat";if(e.type==="private"){const o=ve().user.value;if(o&&e.name.includes(o.name))return e.name.replace(`${o.name} - `,"").replace(` - ${o.name}`,"")}return e.name}canSendMessage(e){return!0}}const Ee={MESSAGE_SENT:"MessageSent",MESSAGE_READ:"MessageRead",MESSAGE_DELETED:"MessageDeleted",CHAT_CREATED:"ChatCreated",CHAT_UPDATED:"ChatUpdated",CHAT_DELETED:"ChatDeleted",USER_ONLINE:"UserOnline",USER_OFFLINE:"UserOffline",USER_TYPING:"UserTyping",USER_STOPPED_TYPING:"UserStoppedTyping"},Ue={CHAT:v=>`chat.${v}`,PRIVATE_USER:v=>`private-user.${v}`,PRIVATE_CHAT:v=>`private-chat.${v}`,PUBLIC_CHAT:v=>`public-chat.${v}`,PUBLIC_USERS:"public-users"},Fe=()=>{const v=A([]),e=A(null),o=A([]),r=A(!1),n=A(null),p=A(null),P=ve().user,k=De().public.chatApiUrl,R=new Le(k),L=async(c=1)=>{r.value=!0,n.value=null;try{const h=await R.getChats(c);console.log(h),v.value=h.chats||[],p.value=h.pagination}catch(h){n.value=h instanceof Error?h.message:"Failed to load chats",console.error("Load chats error:",h)}finally{r.value=!1}},j=async(c,h="user")=>{r.value=!0,n.value=null;try{const d=await R.createPrivateChat(c,h);if(console.log("ðŸš€ Chat created:",d),!d||!d.id)throw new Error("Chat created without valid ID");return v.value.find(w=>w.id===d.id)||v.value.unshift(d),e.value=d,console.log("ðŸŽ¯ CurrentChat set:",e.value),await Y(d.id),d}catch(d){throw n.value=d instanceof Error?d.message:"Failed to start chat",console.error("Start chat error:",d),d}finally{r.value=!1}},K=async(c,h=1)=>{var d;console.log("ðŸ“¥ loadChatMessages chamado para chat ID:",c),r.value=!0,n.value=null;try{const i=await R.getChatMessages(c,h);console.log("ðŸ“¥ getChatMessages response:",i),console.log("ðŸ“¥ Messages array:",i.messages),console.log("ðŸ“¥ Messages length:",(d=i.messages)==null?void 0:d.length),h===1?(o.value=i.messages,console.log("ðŸ“¥ Messages set:",o.value)):o.value.unshift(...i.messages)}catch(i){n.value=i instanceof Error?i.message:"Failed to load messages",console.error("Load chat messages error:",i)}finally{r.value=!1}},F=async c=>{if(console.log("ðŸ“¤ Attempting to send message:",{currentChat:e.value,content:c}),!e.value||!e.value.id||!c.trim()){console.error("Send message error: currentChat or chat ID is undefined",e.value);return}try{console.log("ðŸ“¤ Sending message to chat ID:",e.value.id);const h=await R.sendMessageToChat(e.value.id,c);return e.value&&(e.value.last_message=h,e.value.unread_count=0),h}catch(h){throw n.value=h instanceof Error?h.message:"Failed to send message",console.error("Send message error:",h),h}},z=async(c,h,d="user")=>{try{const i=await R.sendMessageToUser(c,h,d);return v.value.find(b=>b.id===i.chat.id)||v.value.unshift(i.chat),e.value=i.chat,i}catch(i){throw n.value=i instanceof Error?i.message:"Failed to send message",console.error("Send message to user error:",i),i}},C=async c=>{console.log("ðŸŽ¯ selectChat called with:",c),console.log("ðŸŽ¯ Chat ID:",c.id),e.value={...c},console.log("ðŸŽ¯ CurrentChat set:",e.value),await K(c.id),await Y(c.id)},T=c=>R.getChatDisplayName(c),U=c=>R.formatMessage(c),I=c=>{var h;return c.sender_id===((h=P.value)==null?void 0:h.id)},V=H(()=>v.value.filter(c=>c.unread_count>0)),N=H(()=>v.value.reduce((c,h)=>c+h.unread_count,0)),W=H(()=>{console.log("ðŸŽ¨ formattedMessages computed chamada"),console.log("ðŸŽ¨ messages.value:",o.value),console.log("ðŸŽ¨ messages.value.length:",o.value.length);const c=o.value.map(h=>U(h));return console.log("ðŸŽ¨ formatted result:",c),c}),G=()=>{try{console.log("ðŸ”” setupPusherListener started");const{$pusher:c}=de();if(console.log("ðŸ”” Pusher obtained:",c),!c){console.warn("âš ï¸ Pusher not available for listener");return}console.log("ðŸ”” Configuring Pusher listener for new messages...");const h=ve().user.value;console.log("ðŸ”” Current user:",h),h!=null&&h.id?(console.log("ðŸ”” Available chats to configure listener:",v.value),v.value.forEach(d=>{const i=Ue.CHAT(d.id);console.log("ðŸ”” Configuring listener for channel:",i);try{if(c.channel(i)){console.log(`ðŸ”” Already subscribed to channel ${i}, skipping...`);return}const w=c.subscribe(i);console.log("ðŸ”” Channel subscribed:",w),w.bind(Ee.MESSAGE_SENT,b=>{var x;console.log("ðŸ”” Nova mensagem recebida via Pusher:",b);let D=b.created_at;try{if(D){const M=new Date(D);isNaN(M.getTime())&&(console.warn("âš ï¸ Data invÃ¡lida recebida do Pusher:",D),D=new Date().toISOString())}}catch(M){console.warn("âš ï¸ Erro ao processar data do Pusher:",M),D=new Date().toISOString()}const f={id:b.id,chat_id:b.chat_id,content:b.content,sender_id:b.sender_id,sender_type:b.sender_type,message_type:"text",metadata:null,is_read:b.is_read,read_at:null,created_at:D,updated_at:D};o.value.push(f),console.log("ðŸ”” Mensagem adicionada ao estado:",f);const t=v.value.findIndex(M=>M.id===b.chat_id);t!==-1&&(v.value[t].last_message=f,v.value[t].unread_count=(v.value[t].unread_count||0)+1,console.log("ðŸ”” Chat atualizado com nova mensagem")),((x=e.value)==null?void 0:x.id)===b.chat_id&&window.dispatchEvent(new CustomEvent("scroll-to-bottom"))}),console.log(`âœ… Listener configured for chat ${d.id} on channel ${i}`)}catch(w){console.error(`âŒ Error configuring listener for chat ${d.id}:`,w)}})):console.warn("âš ï¸ User not authenticated, cannot configure listener"),console.log("âœ… Listener do Pusher configurado com sucesso")}catch(c){console.error("âŒ Error configuring Pusher listener:",c)}},Y=async c=>{try{console.log(`ðŸ”” setupPusherListenerForChat started for chat ID: ${c}`);const{$pusher:h}=de();if(!h){console.warn("âš ï¸ Pusher not available for specific chat listener");return}const d=Ue.CHAT(c);console.log("ðŸ”” Configuring listener for channel:",d);const i=h.subscribe(d);console.log("ðŸ”” Canal inscrito:",i),i.bind(Ee.MESSAGE_SENT,w=>{var t;console.log("ðŸ”” Nova mensagem recebida via Pusher para chat:",c,w);let b=w.created_at;try{if(b){const x=new Date(b);isNaN(x.getTime())&&(console.warn("âš ï¸ Data invÃ¡lida recebida do Pusher para chat:",c,b),b=new Date().toISOString())}}catch(x){console.warn("âš ï¸ Erro ao processar data do Pusher para chat:",c,x),b=new Date().toISOString()}const D={id:w.id,chat_id:w.chat_id,content:w.content,sender_id:w.sender_id,sender_type:w.sender_type,message_type:"text",metadata:null,is_read:w.is_read,read_at:null,created_at:b,updated_at:b};o.value.push(D),console.log("ðŸ”” Mensagem adicionada ao estado para chat:",c,D);const f=v.value.findIndex(x=>x.id===w.chat_id);f!==-1&&(v.value[f].last_message=D,v.value[f].unread_count=(v.value[f].unread_count||0)+1,console.log("ðŸ”” Chat atualizado com nova mensagem para chat:",c)),((t=e.value)==null?void 0:t.id)===w.chat_id&&window.dispatchEvent(new CustomEvent("scroll-to-bottom"))}),console.log(`âœ… Pusher listener successfully configured for chat ${c}`)}catch(h){console.error(`âŒ Error configuring Pusher listener for chat ${c}:`,h)}},se=()=>{try{console.log("ðŸ§ª Testing Pusher connection...");const{$pusher:c}=de();if(!c){console.error("âŒ Pusher not available for test");return}const h=c.subscribe("test-channel");h.bind("pusher:subscription_succeeded",()=>{console.log("âœ… Connected to test channel"),console.log("âœ… Connection ID:",c.connection.connection.id)}),h.bind("pusher:subscription_error",d=>{console.error("âŒ Subscription error:",d)}),console.log("ðŸ§ª Connection test started")}catch(c){console.error("âŒ Connection test error:",c)}},J=()=>{try{const{$pusher:c}=de();c&&(console.log("ðŸ”” Cleaning up Pusher listener..."),c.disconnect())}catch(c){console.error("âŒ Error cleaning up Pusher listener:",c)}};return Ce(()=>{console.log("ðŸš€ useChatManager - onMounted called"),console.log("ðŸš€ Available chats:",v.value),console.log("ðŸš€ Current user:",P.value),setTimeout(()=>{console.log("ðŸš€ Executing setupPusherListener after delay"),G()},1e3)}),Se(()=>{J()}),{chats:B(v),currentChat:B(e),messages:B(o),loading:B(r),error:B(n),pagination:B(p),unreadChats:V,totalUnread:N,formattedMessages:W,currentUser:P,loadChats:L,startChatWithUser:j,loadChatMessages:K,sendMessage:F,sendMessageToUser:z,selectChat:C,getChatDisplayName:T,formatMessage:U,isOwnMessage:I,testPusherConnection:se,setupPusherListenerForChat:Y}},ze={class:"chat-interface"},Oe={class:"chat-header"},je={class:"d-flex align-center justify-space-between w-100"},Ge={class:"d-flex align-center"},Be={class:"text-h6"},He={key:0,class:"text-caption text-grey"},Ke={key:1,class:"text-caption text-grey"},We={class:"d-flex align-center"},Ye={key:0,class:"conversations-list"},qe={key:0,class:"text-center pa-4"},Je={key:1,class:"pa-4"},Qe={key:2,class:"text-center pa-8"},Xe={key:3,class:"chats"},Ze=["onClick"],et={class:"conversation-avatar"},tt={class:"conversation-content"},at={class:"conversation-header"},st={class:"text-subtitle-1 font-weight-medium"},ot={class:"text-caption text-grey"},nt={class:"text-body-2 text-grey conversation-preview"},rt={key:1,class:"chat-main"},lt={key:0,class:"text-center pa-4"},it={key:1,class:"pa-4"},ct={key:2,class:"text-center pa-8"},dt={class:"text-body-2 text-grey"},ut={key:3,class:"messages-list"},ht={class:"message-content"},vt={class:"message-header"},pt={class:"message-author"},mt={class:"message-time"},gt={class:"message-text"},ft={class:"chat-input"},_t={key:0,class:"send-error mb-2"},Ct={class:"d-flex align-end"},yt=Ae({__name:"ChatInterface",props:{initialUser:{default:null},initialChat:{default:null}},emits:["close"],setup(v,{emit:e}){const o=v,r=e,n=A(""),p=A(),P=A(""),{chats:q,currentChat:k,messages:R,loading:L,error:j,formattedMessages:K,loadChats:F,loadChatMessages:z,selectChat:C,sendMessage:T,startChatWithUser:U,getChatDisplayName:I,testPusherConnection:V}=Fe(),N=H(()=>k.value?I(k.value):o.initialUser?`Chat com ${o.initialUser.name}`:"Chat"),W=()=>{r("close")},G=async()=>{if(n.value.trim()){console.log("ðŸ’¬ handleSendMessage chamado:",{currentChat:k.value,initialUser:o.initialUser,message:n.value});try{if(P.value="",k.value)console.log("ðŸ’¬ Enviando mensagem para chat existente:",k.value.id),await T(n.value),n.value="";else if(o.initialUser){console.log("ðŸ’¬ Criando novo chat com usuÃ¡rio:",o.initialUser.id);const d=await U(o.initialUser.id,"user");d&&d.id&&(await ue(),await T(n.value),n.value="")}}catch(d){console.error("Erro ao enviar mensagem:",d),P.value="Erro ao enviar mensagem. Tente novamente.",setTimeout(()=>{P.value=""},3e3)}}},Y=async()=>{if(o.initialUser&&!k.value)try{console.log("ðŸš€ Iniciando chat com usuÃ¡rio:",o.initialUser);const d=await U(o.initialUser.id,"user");d&&d.id&&(console.log("ðŸ“¥ Carregando mensagens do chat criado:",d.id),await ue(),await z(d.id))}catch(d){console.error("Erro ao inicializar chat:",d),P.value="Erro ao inicializar chat. Tente novamente.",setTimeout(()=>{P.value=""},5e3)}},se=()=>{},J=()=>{ue(()=>{p.value&&(p.value.scrollTop=p.value.scrollHeight)})},c=d=>{if(!d)return"--:--";try{const i=new Date(d);return isNaN(i.getTime())?"--:--":i.toLocaleTimeString("pt-BR",{hour:"2-digit",minute:"2-digit"})}catch(i){return console.warn("Erro ao formatar data:",i,d),"--:--"}},h=d=>d.isOwn?"VocÃª":d.user_name||"UsuÃ¡rio";return Ce(async()=>{o.initialUser||await F(),await Y(),window.addEventListener("scroll-to-bottom",J)}),Se(()=>{window.removeEventListener("scroll-to-bottom",J)}),_e(()=>o.initialChat,d=>{d&&C(d)},{immediate:!0}),_e(()=>o.initialUser,async d=>{if(d&&!k.value)try{await Y()}catch(i){console.error("Erro ao inicializar chat com usuÃ¡rio:",i),P.value="Erro ao inicializar chat. Tente novamente.",setTimeout(()=>{P.value=""},5e3)}},{immediate:!0}),_e(k,()=>{k.value&&ue(()=>{J()})}),console.log("ðŸŽ¯ ChatInterface carregado com initialChat:",o.initialChat,"initialUser:",o.initialUser),(d,i)=>{const w=E("v-icon"),b=E("v-btn"),D=E("v-progress-circular"),f=E("v-alert"),t=E("v-avatar"),x=E("v-badge"),M=E("v-text-field"),O=E("v-form");return y(),S("div",ze,[l("div",Oe,[l("div",je,[l("div",Ge,[g(k)?(y(),Z(b,{key:0,onClick:W,icon:"",size:"small",variant:"text",class:"mr-2"},{default:s(()=>[a(w,null,{default:s(()=>i[2]||(i[2]=[m("mdi-arrow-left")])),_:1})]),_:1})):ae("",!0),a(w,{color:"primary",class:"mr-2"},{default:s(()=>i[3]||(i[3]=[m("mdi-chat")])),_:1}),l("div",null,[l("h3",Be,_(N.value),1),g(k)?(y(),S("p",He,_(g(k).type==="private"?"Chat privado":"Chat em grupo"),1)):d.initialUser?(y(),S("p",Ke,_(d.initialUser.email),1)):ae("",!0)])]),l("div",We,[a(b,{onClick:g(V),icon:"",size:"small",variant:"text",class:"mr-2",title:"Testar conexÃ£o Pusher"},{default:s(()=>[a(w,null,{default:s(()=>i[4]||(i[4]=[m("mdi-wifi")])),_:1})]),_:1},8,["onClick"]),a(b,{onClick:i[0]||(i[0]=$=>d.$emit("close")),icon:"",size:"small",variant:"text"},{default:s(()=>[a(w,null,{default:s(()=>i[5]||(i[5]=[m("mdi-close")])),_:1})]),_:1})])])]),!g(k)&&!d.initialUser?(y(),S("div",Ye,[g(L)?(y(),S("div",qe,[a(D,{indeterminate:"",color:"primary"})])):g(j)?(y(),S("div",Je,[a(f,{type:"error",variant:"tonal"},{default:s(()=>[m(_(g(j)),1)]),_:1})])):g(q).length===0?(y(),S("div",Qe,[a(w,{size:"64",color:"grey",class:"mb-4"},{default:s(()=>i[6]||(i[6]=[m("mdi-chat-outline")])),_:1}),i[7]||(i[7]=l("h3",{class:"text-h6 mb-2"},"Nenhum chat",-1)),i[8]||(i[8]=l("p",{class:"text-body-2 text-grey"}," Inicie um chat com um usuÃ¡rio para comeÃ§ar a conversar. ",-1))])):(y(),S("div",Xe,[(y(!0),S(pe,null,me(g(q),$=>{var Q,ee,oe;return y(),S("div",{key:$.id,onClick:ye=>g(C)($),class:be(["conversation-item",{active:((Q=g(k))==null?void 0:Q.id)===$.id}])},[l("div",et,[a(t,{size:"48",color:"primary"},{default:s(()=>[a(w,null,{default:s(()=>i[9]||(i[9]=[m("mdi-account")])),_:1})]),_:1}),$.unread_count>0?(y(),Z(x,{key:0,content:$.unread_count,color:"error",dot:"",class:"conversation-badge"},null,8,["content"])):ae("",!0)]),l("div",tt,[l("div",at,[l("h4",st,_(g(I)($)),1),l("span",ot,_(c((ee=$.last_message)==null?void 0:ee.created_at)),1)]),l("p",nt,_(((oe=$.last_message)==null?void 0:oe.content)||"Nenhuma mensagem ainda"),1)])],10,Ze)}),128))]))])):(y(),S("div",rt,[l("div",{ref_key:"messagesContainer",ref:p,class:"chat-messages",onScroll:se},[g(L)?(y(),S("div",lt,[a(D,{indeterminate:"",color:"primary"})])):g(j)?(y(),S("div",it,[a(f,{type:"error",variant:"tonal"},{default:s(()=>[m(_(g(j)),1)]),_:1})])):g(R).length===0?(y(),S("div",ct,[a(w,{size:"64",color:"grey",class:"mb-4"},{default:s(()=>i[10]||(i[10]=[m("mdi-message-outline")])),_:1}),i[11]||(i[11]=l("h3",{class:"text-h6 mb-2"},"Nenhuma mensagem",-1)),l("p",dt,_(d.initialUser?`Inicie um chat com ${d.initialUser.name}!`:"Seja o primeiro a enviar uma mensagem!"),1)])):(y(),S("div",ut,[(y(!0),S(pe,null,me(g(K),$=>(y(),S("div",{key:$.id,class:be(["message-item",{"message-own":$.isOwn}])},[l("div",ht,[l("div",vt,[l("span",pt,_(h($)),1),l("span",mt,_($.time),1)]),l("div",gt,_($.content),1)])],2))),128))]))],544),l("div",ft,[P.value?(y(),S("div",_t,[a(f,{type:"error",variant:"tonal",density:"compact"},{default:s(()=>[m(_(P.value),1)]),_:1})])):ae("",!0),a(O,{onSubmit:Re(G,["prevent"])},{default:s(()=>[l("div",Ct,[a(M,{modelValue:n.value,"onUpdate:modelValue":i[1]||(i[1]=$=>n.value=$),onKeydown:Ie(G,["enter"]),placeholder:d.initialUser?`Digite uma mensagem para ${d.initialUser.name}...`:"Digite sua mensagem...",variant:"outlined",density:"compact","hide-details":"",class:"flex-grow-1 mr-2",disabled:g(L)},null,8,["modelValue","placeholder","disabled"]),a(b,{onClick:G,color:"primary",icon:"",disabled:!n.value.trim()||g(L)},{default:s(()=>[a(w,null,{default:s(()=>i[12]||(i[12]=[m("mdi-send")])),_:1})]),_:1},8,["disabled"])])]),_:1})])]))])}}}),wt=Pe(yt,[["__scopeId","data-v-72bf487a"]]),xt=()=>{const v=A([]),e=A(null),o=A(!1),r=A(null),n=new Ne,p=async(C=1,T=15)=>{o.value=!0,r.value=null;try{const U=await n.getUsers(C,T);U.success&&U.data?(v.value=U.data.users,e.value=U.data.pagination):r.value=U.error||"Failed to load users"}catch{r.value="Unexpected error loading users"}finally{o.value=!1}},P=()=>{e.value&&e.value.current_page<e.value.last_page&&p(e.value.current_page+1,e.value.per_page)},q=()=>{e.value&&e.value.current_page>1&&p(e.value.current_page-1,e.value.per_page)},k=C=>{e.value&&C>=1&&C<=e.value.last_page&&p(C,e.value.per_page)},R=C=>{p(1,C)},L=C=>({...C,role:"User",status:C.email_verified_at?"Ativo":"Pendente",statusColor:C.email_verified_at?"success":"warning",avatar:`/images/profile/user-${C.id%8+1}.jpg`,phone:`+55 (11) ${String(C.id).padStart(5,"0")}-${String(C.id).padStart(4,"0")}`,department:"TI",lastLogin:C.email_verified_at?C.updated_at:"Nunca"}),j=H(()=>v.value.map(L)),K=H(()=>e.value&&e.value.current_page<e.value.last_page),F=H(()=>e.value&&e.value.current_page>1),z=H(()=>{if(!e.value)return[];const C=[],T=e.value.current_page,U=e.value.last_page;let I=Math.max(1,T-2),V=Math.min(U,T+2);T<=3?V=Math.min(U,5):T>=U-2&&(I=Math.max(1,U-4));for(let N=I;N<=V;N++)C.push(N);return C});return{users:B(v),pagination:B(e),loading:B(o),error:B(r),formattedUsers:j,canGoNext:K,canGoPrev:F,pageNumbers:z,loadUsers:p,nextPage:P,prevPage:q,goToPage:k,changePerPage:R,formatUserForDisplay:L}},bt={class:"d-flex align-center justify-space-between"},Et={class:"d-flex gap-2"},Ut={class:"d-flex justify-center align-center py-8"},St={class:"d-flex align-center"},At=["src","alt"],Pt={class:"font-weight-medium"},kt={class:"text-caption text-medium-emphasis"},Mt={class:"d-flex justify-center gap-1"},$t={key:0,class:"d-flex align-center justify-space-between mt-4"},Tt={class:"text-body-2 text-medium-emphasis"},Dt={class:"d-flex align-center gap-2"},Rt={class:"d-flex gap-1"},It={class:"text-body-2"},Nt={class:"d-flex align-center gap-3"},Vt={class:"text-h6"},Lt={class:"text-caption text-medium-emphasis"},Ft=Ae({__name:"index",setup(v){const{formattedUsers:e,pagination:o,loading:r,error:n,loadUsers:p,nextPage:P,prevPage:q,goToPage:k,changePerPage:R,canGoNext:L,canGoPrev:j,pageNumbers:K}=xt(),F=A(""),z=A("all"),C=A("all"),T=A("all"),U=A(!1),I=A(!1),V=A(!1),N=A(null),W=A(!1),G=A(null),Y=[{value:"all",label:"All Status"},{value:"Ativo",label:"Active"},{value:"Pendente",label:"Pending"}],se=[{value:"all",label:"All Roles"},{value:"User",label:"User"}],J=[{value:"all",label:"All Departments"},{value:"TI",label:"IT"}],c=H(()=>e.value.filter(f=>{const t=f.name.toLowerCase().includes(F.value.toLowerCase())||f.email.toLowerCase().includes(F.value.toLowerCase()),x=z.value==="all"||f.status===z.value,M=C.value==="all"||f.role===C.value,O=T.value==="all"||f.department===T.value;return t&&x&&M&&O})),h=()=>{U.value=!0},d=f=>{N.value={...f},I.value=!0},i=f=>{N.value=f,V.value=!0},w=()=>{var f,t;N.value&&(V.value=!1,N.value=null,p(((f=o.value)==null?void 0:f.current_page)||1,((t=o.value)==null?void 0:t.per_page)||15))},b=f=>{f.status==="Active"?(f.status="Pending",f.statusColor="warning"):(f.status="Active",f.statusColor="success")},D=()=>{F.value="",z.value="all",C.value="all",T.value="all"};return Ce(()=>{p()}),(f,t)=>{const x=E("v-btn"),M=E("v-col"),O=E("v-row"),$=E("v-text-field"),Q=E("v-select"),ee=E("v-chip"),oe=E("v-progress-circular"),ye=E("v-alert"),we=E("v-avatar"),X=E("v-icon"),ke=E("v-table"),ne=E("v-card-title"),re=E("v-card-text"),ge=E("v-spacer"),fe=E("v-card-actions"),le=E("v-card"),ie=E("v-dialog"),Me=wt;return y(),S("div",null,[a(O,{class:"mb-4"},{default:s(()=>[a(M,{cols:"12"},{default:s(()=>[l("div",bt,[t[16]||(t[16]=l("div",null,[l("h1",{class:"text-h4 font-weight-bold"},"Users"),l("p",{class:"text-body-1 text-medium-emphasis"}," Manage all system users ")],-1)),a(x,{color:"primary","prepend-icon":"mdi-plus",onClick:h,size:"large"},{default:s(()=>t[15]||(t[15]=[m(" Add User ")])),_:1})])]),_:1})]),_:1}),a(O,{class:"mb-6"},{default:s(()=>[a(M,{cols:"12"},{default:s(()=>[a(he,{title:"Filters"},{default:s(()=>[a(O,null,{default:s(()=>[a(M,{cols:"12",md:"3"},{default:s(()=>[a($,{modelValue:F.value,"onUpdate:modelValue":t[0]||(t[0]=u=>F.value=u),label:"Search by name or email","prepend-inner-icon":"mdi-magnify",variant:"outlined",density:"compact",clearable:""},null,8,["modelValue"])]),_:1}),a(M,{cols:"12",md:"3"},{default:s(()=>[a(Q,{modelValue:z.value,"onUpdate:modelValue":t[1]||(t[1]=u=>z.value=u),items:Y,"item-title":"label","item-value":"value",label:"Status",variant:"outlined",density:"compact"},null,8,["modelValue"])]),_:1}),a(M,{cols:"12",md:"3"},{default:s(()=>[a(Q,{modelValue:C.value,"onUpdate:modelValue":t[2]||(t[2]=u=>C.value=u),items:se,"item-title":"label","item-value":"value",label:"Role",variant:"outlined",density:"compact"},null,8,["modelValue"])]),_:1}),a(M,{cols:"12",md:"3"},{default:s(()=>[a(Q,{modelValue:T.value,"onUpdate:modelValue":t[3]||(t[3]=u=>T.value=u),items:J,"item-title":"label","item-value":"value",label:"Department",variant:"outlined",density:"compact"},null,8,["modelValue"])]),_:1})]),_:1}),a(O,null,{default:s(()=>[a(M,{cols:"12"},{default:s(()=>[l("div",Et,[a(x,{variant:"outlined",onClick:D,"prepend-icon":"mdi-refresh"},{default:s(()=>t[17]||(t[17]=[m(" Clear Filters ")])),_:1}),a(ee,{color:"primary",variant:"tonal",class:"ml-auto"},{default:s(()=>[m(_(c.value.length)+" users found ",1)]),_:1})])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),g(r)?(y(),Z(O,{key:0},{default:s(()=>[a(M,{cols:"12"},{default:s(()=>[a(he,null,{default:s(()=>[l("div",Ut,[a(oe,{indeterminate:"",color:"primary",size:"64"})])]),_:1})]),_:1})]),_:1})):g(n)?(y(),Z(O,{key:1},{default:s(()=>[a(M,{cols:"12"},{default:s(()=>[a(he,null,{default:s(()=>[a(ye,{type:"error",variant:"tonal",class:"mb-0"},{default:s(()=>[m(_(g(n)),1)]),_:1})]),_:1})]),_:1})]),_:1})):(y(),Z(O,{key:2},{default:s(()=>[a(M,{cols:"12"},{default:s(()=>[a(he,{title:"Users List"},{default:s(()=>[a(ke,{"fixed-header":"",height:"600px"},{default:s(()=>[t[20]||(t[20]=l("thead",null,[l("tr",null,[l("th",{class:"text-left"},"User"),l("th",{class:"text-left"},"Email"),l("th",{class:"text-left"},"Role"),l("th",{class:"text-left"},"Department"),l("th",{class:"text-left"},"Status"),l("th",{class:"text-left"},"Last Login"),l("th",{class:"text-left"},"Created At"),l("th",{class:"text-center"},"Actions")])],-1)),l("tbody",null,[(y(!0),S(pe,null,me(c.value,u=>(y(),S("tr",{key:u.id},[l("td",null,[l("div",St,[a(we,{size:"40",class:"mr-3"},{default:s(()=>[l("img",{src:u.avatar,alt:u.name},null,8,At)]),_:2},1024),l("div",null,[l("div",Pt,_(u.name),1),l("div",kt,_(u.phone),1)])])]),l("td",null,_(u.email),1),l("td",null,[a(ee,{color:u.role==="Admin"?"error":u.role==="Manager"?"warning":u.role==="Editor"?"info":"default",variant:"tonal",size:"small"},{default:s(()=>[m(_(u.role),1)]),_:2},1032,["color"])]),l("td",null,_(u.department),1),l("td",null,[a(ee,{color:u.statusColor,variant:"tonal",size:"small"},{default:s(()=>[m(_(u.status),1)]),_:2},1032,["color"])]),l("td",null,_(u.lastLogin),1),l("td",null,_(new Date(u.created_at).toLocaleDateString("pt-BR")),1),l("td",null,[l("div",Mt,[a(x,{icon:"",size:"small",variant:"text",color:"primary",onClick:te=>d(u),title:"Edit"},{default:s(()=>[a(X,null,{default:s(()=>t[18]||(t[18]=[m("mdi-pencil")])),_:1})]),_:2},1032,["onClick"]),a(x,{icon:"",size:"small",variant:"text",color:u.status==="Active"?"warning":"success",onClick:te=>b(u),title:u.status==="Active"?"Deactivate":"Activate"},{default:s(()=>[a(X,null,{default:s(()=>[m(_(u.status==="Active"?"mdi-account-off":"mdi-account-check"),1)]),_:2},1024)]),_:2},1032,["color","onClick","title"]),a(x,{icon:"",size:"small",variant:"text",color:"error",onClick:te=>i(u),title:"Delete"},{default:s(()=>[a(X,null,{default:s(()=>t[19]||(t[19]=[m("mdi-delete")])),_:1})]),_:2},1032,["onClick"])])])]))),128))])]),_:1}),g(o)?(y(),S("div",$t,[l("div",Tt," Showing "+_(g(o).from)+" to "+_(g(o).to)+" of "+_(g(o).total)+" users ",1),l("div",Dt,[a(Q,{"model-value":g(o).per_page,"onUpdate:modelValue":g(R),items:[10,15,25,50],variant:"outlined",density:"compact","hide-details":"",style:{width:"80px"}},null,8,["model-value","onUpdate:modelValue"]),a(x,{icon:"",variant:"text",disabled:!g(j),onClick:g(q),title:"Previous page"},{default:s(()=>[a(X,null,{default:s(()=>t[21]||(t[21]=[m("mdi-chevron-left")])),_:1})]),_:1},8,["disabled","onClick"]),l("div",Rt,[(y(!0),S(pe,null,me(g(K),u=>(y(),Z(x,{key:u,color:u===g(o).current_page?"primary":void 0,variant:"text",size:"small",onClick:te=>g(k)(u)},{default:s(()=>[m(_(u),1)]),_:2},1032,["color","onClick"]))),128))]),a(x,{icon:"",variant:"text",disabled:!g(L),onClick:g(P),title:"Next page"},{default:s(()=>[a(X,null,{default:s(()=>t[22]||(t[22]=[m("mdi-chevron-right")])),_:1})]),_:1},8,["disabled","onClick"])])])):ae("",!0)]),_:1})]),_:1})]),_:1})),a(ie,{modelValue:U.value,"onUpdate:modelValue":t[6]||(t[6]=u=>U.value=u),"max-width":"600px"},{default:s(()=>[a(le,null,{default:s(()=>[a(ne,{class:"text-h5"},{default:s(()=>t[23]||(t[23]=[m(" Add New User ")])),_:1}),a(re,null,{default:s(()=>t[24]||(t[24]=[l("p",{class:"text-body-2 text-medium-emphasis"}," User addition form will be implemented here. ",-1)])),_:1}),a(fe,null,{default:s(()=>[a(ge),a(x,{color:"grey-darken-1",variant:"text",onClick:t[4]||(t[4]=u=>U.value=!1)},{default:s(()=>t[25]||(t[25]=[m(" Cancel ")])),_:1}),a(x,{color:"primary",onClick:t[5]||(t[5]=u=>U.value=!1)},{default:s(()=>t[26]||(t[26]=[m(" Add ")])),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(ie,{modelValue:I.value,"onUpdate:modelValue":t[9]||(t[9]=u=>I.value=u),"max-width":"600px"},{default:s(()=>[a(le,null,{default:s(()=>[a(ne,{class:"text-h5"},{default:s(()=>t[27]||(t[27]=[m(" Edit User ")])),_:1}),a(re,null,{default:s(()=>t[28]||(t[28]=[l("p",{class:"text-body-2 text-medium-emphasis"}," Edit form will be implemented here. ",-1)])),_:1}),a(fe,null,{default:s(()=>[a(ge),a(x,{color:"grey-darken-1",variant:"text",onClick:t[7]||(t[7]=u=>I.value=!1)},{default:s(()=>t[29]||(t[29]=[m(" Cancel ")])),_:1}),a(x,{color:"primary",onClick:t[8]||(t[8]=u=>I.value=!1)},{default:s(()=>t[30]||(t[30]=[m(" Save ")])),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(ie,{modelValue:V.value,"onUpdate:modelValue":t[11]||(t[11]=u=>V.value=u),"max-width":"400px"},{default:s(()=>[a(le,null,{default:s(()=>[a(ne,{class:"text-h5"},{default:s(()=>t[31]||(t[31]=[m(" Confirm Deletion ")])),_:1}),a(re,null,{default:s(()=>{var u;return[l("p",It,[t[32]||(t[32]=m(" Are you sure you want to delete the user ")),l("strong",null,_((u=N.value)==null?void 0:u.name),1),t[33]||(t[33]=m("? "))]),t[34]||(t[34]=l("p",{class:"text-caption text-medium-emphasis"}," This action cannot be undone. ",-1))]}),_:1}),a(fe,null,{default:s(()=>[a(ge),a(x,{color:"grey-darken-1",variant:"text",onClick:t[10]||(t[10]=u=>V.value=!1)},{default:s(()=>t[35]||(t[35]=[m(" Cancel ")])),_:1}),a(x,{color:"error",onClick:w},{default:s(()=>t[36]||(t[36]=[m(" Delete ")])),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(ie,{modelValue:W.value,"onUpdate:modelValue":t[14]||(t[14]=u=>W.value=u),"max-width":"800px",persistent:""},{default:s(()=>[a(le,{class:"chat-dialog-card"},{default:s(()=>[a(ne,{class:"d-flex align-center justify-space-between pa-4"},{default:s(()=>{var u,te;return[l("div",Nt,[a(we,{size:"40",color:"primary"},{default:s(()=>[a(X,null,{default:s(()=>t[37]||(t[37]=[m("mdi-account")])),_:1})]),_:1}),l("div",null,[l("div",Vt,"Chat with "+_((u=G.value)==null?void 0:u.name),1),l("div",Lt,_((te=G.value)==null?void 0:te.email),1)])]),a(x,{icon:"",variant:"text",onClick:t[12]||(t[12]=zt=>W.value=!1),title:"Close"},{default:s(()=>[a(X,null,{default:s(()=>t[38]||(t[38]=[m("mdi-close")])),_:1})]),_:1})]}),_:1}),a(re,{class:"chat-dialog-content pa-0"},{default:s(()=>[G.value?(y(),Z(Me,{key:0,"initial-chat":null,"initial-user":G.value,onClose:t[13]||(t[13]=u=>W.value=!1)},null,8,["initial-user"])):ae("",!0)]),_:1})]),_:1})]),_:1},8,["modelValue"])])}}}),Bt=Pe(Ft,[["__scopeId","data-v-b5a3edef"]]);export{Bt as default};
